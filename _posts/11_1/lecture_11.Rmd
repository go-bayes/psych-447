---
title: "Causal inference, confounding, and directed acylical graphs (DAGS) "
description: 
author:
  - name: Joseph Bulbulia
    url: https://josephbulbulia.netlify.app
    affiliation: Victoria University of Wellington
    affiliation_url: https://www.wgtn.ac.nz
    orcid_id: 0000-0002-5861-2056
date: 2021-MAY-11 
output:
  distill::distill_article:
    self_contained: false
    toc: true
    code_folding: true
    highlight: kate
bibliography: references.bib
---

```{r echo=F}
knitr::include_graphics("op.png")
```

## Required readings

Required readings are as follows:

-   @rohrer2018 [link](https://journals.sagepub.com/doi/full/10.1177/2515245917745629)
-   @barrett2021 [link](https://cran.r-project.org/package=ggdag)
-   @mcelreath2020[link](https://tewaharoa.victoria.ac.nz/discovery/fulldisplay?docid=alma99179374299902386&context=L&vid=64VUW_INST:VUWNUI&search_scope=MyInst_and_CI&tab=all&lang=en)


```{r echo = TRUE, include = FALSE}
# packages
# install_rethinking
# function for installing dependencies
ipak <- function(pkg){
new.pkg <- pkg[!(pkg %in% installed.packages()[, "Package"])]
if (length(new.pkg)) 
    install.packages(new.pkg, dependencies = TRUE) 
sapply(pkg, require, character.only = TRUE)
}
# usage
packages <- c("coda", "plyr", "mvtnorm", "scales", "dagitty")
ipak(packages)
# next install rethinking
if (!require(rethinking)) {
  devtools::install_github("rmcelreath/rethinking")
}
#next install ggdag
if (!require(rethinking)) {
  devtools::install_github("malcolmbarrett/ggdag")
}
if (!require(rethinking)) {
  devtools::install_github("larmarange/labelled")
}
# installed from previous lectures
library("equatiomatic")
library("tidyverse")
library("ggdag")
library("brms")
library("rstan")
library("rstanarm")
library("tidybayes")
library("bayesplot")
library("easystats")
# rstan options
rstan_options(auto_write=TRUE)
options(mc.cores=parallel::detectCores ())
theme_set(theme_classic())
```

## Objectives 

- To clarify the concepts of causal inference and causal confounding
- To use these concepts, in combination with the `ggdag` package, to develop a workflow for causal inference that mitigates the risks of causal confounding. 
- To introduce tools for multiple-imputation, which addresses missing data problems that may lead to causal confounding. 



## What is causal inference? 

Up to this point in the course, we have been using regression for prediction, asking: 

> what is the expected change in why conditional on different levels or increments of x

Prediction is useful for many practical questions:

- "Which candidate is more likely to win the election?"
- "How many babies will be born in New Zealand during the next decade?"
- "Are people getting happier as they get older?"

However, scientists seek causal explanations: 

- Why did people who in 2012 voted for Barack Obama switch party vote in 2016 to support Donald Trump? (If the pattern of variation of stability and change is not random what causes the pattern?)

To address the question of stability and change in political allegiance we need a theory of political motivation.

- Does marriage cause people to become happier? Observing that people who are married are happier does not settle this question because happiness might cause marriage. 

- Does appearing more ethnic cause people to experience greater levels of prejudice? 


Most of the theories in psychological science are causal explanations: they make claims about how people think and why they act.  Regression enables use to examine the correlations outcome variables and predictor variables. As such, it is an exquisite crystal ball into the future. However, to use regression to answer "Why"  causal inference we need to proceed with caution. 

### The difference between prediction and explanation?

## What is causal confounding?

```{r figopen, echo=F}
knitr::include_graphics("op2.png")
```

## Examples of confounding

```{r echo = FALSE, include = FALSE}
N <-100
age <- rnorm( N )# sim A
mar <- rnorm( N , -age ) # sim A -> M
div <- rnorm( N , age ) # sim A -> D
df <- data.frame(age,mar,div)
plot(age ~ mar)
md<-lm(mar ~ age, data = df)
summary(md)
sjPlot::plot_model(md)
```

```{r echo = FALSE, include = FALSE}
## Confound 
south<-rnorm(N)
waffles <-rnorm(N, south)
age <- rnorm(N, south)
mar <- rnorm( N, -age ) # sim A -> M
div <- rnorm( N,  age ) # sim A -> D
df <- data.frame(age,mar,div,south,waffles)
md<-lm(div ~ waffles + mar + south, data = df)
summary(md)
sjPlot::plot_model(md)
```


## NZ example

The New Zealand Attitudes and Values Study that is relevant to evaluating the theory of whether prototypicality of M훮ori group membership "moderates" the effect of perceived discrimination on ethnic identity in M훮ori.^[I place "moderates" in shutter quotations because it is not clear what this means: moderates as in predicts or moderates as in causes.] 

The variables are from *Wave 4* of the NZAVS jitter2 data set are:

- T4.MAORI.GME  (M훮ori Group membership and evaluation)
- T4.MAORI.VEM (M훮ori Perceived Appearance)
- Perc.Discrim.T04 (Perceived discrimination - ethnicity)
  * I Feel that I am often discriminated against because of my ethnicity.
  * I feel that I am often discriminated against because of my ethnicity.


```{r}
# importa data:
```

