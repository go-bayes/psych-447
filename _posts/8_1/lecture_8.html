<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    background-color: #ffffff;
    color: #a0a0a0;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #a0a0a0;  padding-left: 4px; }
div.sourceCode
  { color: #1f1c1b; background-color: #ffffff; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span { color: #1f1c1b; } /* Normal */
code span.al { color: #bf0303; background-color: #f7e6e6; font-weight: bold; } /* Alert */
code span.an { color: #ca60ca; } /* Annotation */
code span.at { color: #0057ae; } /* Attribute */
code span.bn { color: #b08000; } /* BaseN */
code span.bu { color: #644a9b; font-weight: bold; } /* BuiltIn */
code span.cf { color: #1f1c1b; font-weight: bold; } /* ControlFlow */
code span.ch { color: #924c9d; } /* Char */
code span.cn { color: #aa5500; } /* Constant */
code span.co { color: #898887; } /* Comment */
code span.cv { color: #0095ff; } /* CommentVar */
code span.do { color: #607880; } /* Documentation */
code span.dt { color: #0057ae; } /* DataType */
code span.dv { color: #b08000; } /* DecVal */
code span.er { color: #bf0303; text-decoration: underline; } /* Error */
code span.ex { color: #0095ff; font-weight: bold; } /* Extension */
code span.fl { color: #b08000; } /* Float */
code span.fu { color: #644a9b; } /* Function */
code span.im { color: #ff5500; } /* Import */
code span.in { color: #b08000; } /* Information */
code span.kw { color: #1f1c1b; font-weight: bold; } /* Keyword */
code span.op { color: #1f1c1b; } /* Operator */
code span.ot { color: #006e28; } /* Other */
code span.pp { color: #006e28; } /* Preprocessor */
code span.re { color: #0057ae; background-color: #e0e9f8; } /* RegionMarker */
code span.sc { color: #3daee9; } /* SpecialChar */
code span.ss { color: #ff5500; } /* SpecialString */
code span.st { color: #bf0303; } /* String */
code span.va { color: #0057ae; } /* Variable */
code span.vs { color: #bf0303; } /* VerbatimString */
code span.wa { color: #bf0303; } /* Warning */
</style>

  <!--radix_placeholder_meta_tags-->
  <title>Generalised linear models</title>

  <meta property="description" itemprop="description" content="Estimating binary responses, counts, rates, overdispersion, and zero-inflation"/>


  <!--  https://schema.org/Article -->
  <meta property="article:published" itemprop="datePublished" content="2021-04-27"/>
  <meta property="article:created" itemprop="dateCreated" content="2021-04-27"/>
  <meta name="article:author" content="Joseph Bulbulia"/>

  <!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
  <meta property="og:title" content="Generalised linear models"/>
  <meta property="og:type" content="article"/>
  <meta property="og:description" content="Estimating binary responses, counts, rates, overdispersion, and zero-inflation"/>
  <meta property="og:locale" content="en_US"/>

  <!--  https://dev.twitter.com/cards/types/summary -->
  <meta property="twitter:card" content="summary"/>
  <meta property="twitter:title" content="Generalised linear models"/>
  <meta property="twitter:description" content="Estimating binary responses, counts, rates, overdispersion, and zero-inflation"/>

  <!--/radix_placeholder_meta_tags-->
  
  <meta name="citation_reference" content="citation_publication_date=2020;citation_publisher=Zenodo;citation_doi=10.5281/zenodo.4080013;citation_author=A. Solomon Kurz"/>
  <meta name="citation_reference" content="citation_title=Regression and other stories;citation_publication_date=2020;citation_publisher=Cambridge University Press;citation_author=Andrew Gelman;citation_author=Jennifer Hill;citation_author=Aki Vehtari"/>
  <meta name="citation_reference" content="citation_title=Ordinal regression models in psychology: A tutorial;citation_publication_date=2019;citation_publisher=SAGE;citation_volume=2;citation_author=Paul-Christian Bürkner;citation_author=Matti Vuorre"/>
  <!--radix_placeholder_rmarkdown_metadata-->

  <script type="text/json" id="radix-rmarkdown-metadata">
  {"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","author","date","output","bibliography"]}},"value":[{"type":"character","attributes":{},"value":["Generalised linear models"]},{"type":"character","attributes":{},"value":["Estimating binary responses, counts, rates, overdispersion, and zero-inflation"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","url","affiliation","affiliation_url","orcid_id"]}},"value":[{"type":"character","attributes":{},"value":["Joseph Bulbulia"]},{"type":"character","attributes":{},"value":["https://josephbulbulia.netlify.app"]},{"type":"character","attributes":{},"value":["Victoria University of Wellington"]},{"type":"character","attributes":{},"value":["https://www.wgtn.ac.nz"]},{"type":"character","attributes":{},"value":["0000-0002-5861-2056"]}]}]},{"type":"character","attributes":{},"value":["2021-APRIL-27"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained","toc","highlight"]}},"value":[{"type":"logical","attributes":{},"value":[false]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["kate"]}]}]},{"type":"character","attributes":{},"value":["bib.bib"]}]}
  </script>
  <!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["bib.bib","extra.css","lecture_8_files/anchor-4.2.2/anchor.min.js","lecture_8_files/bowser-1.9.3/bowser.min.js","lecture_8_files/distill-2.2.21/template.v2.js","lecture_8_files/figure-html5/unnamed-chunk-1-1.png","lecture_8_files/figure-html5/unnamed-chunk-13-1.png","lecture_8_files/figure-html5/unnamed-chunk-16-1.png","lecture_8_files/figure-html5/unnamed-chunk-17-1.png","lecture_8_files/figure-html5/unnamed-chunk-18-1.png","lecture_8_files/figure-html5/unnamed-chunk-2-1.png","lecture_8_files/figure-html5/unnamed-chunk-21-1.png","lecture_8_files/figure-html5/unnamed-chunk-23-1.png","lecture_8_files/figure-html5/unnamed-chunk-24-1.png","lecture_8_files/figure-html5/unnamed-chunk-27-1.png","lecture_8_files/figure-html5/unnamed-chunk-28-1.png","lecture_8_files/figure-html5/unnamed-chunk-28-2.png","lecture_8_files/figure-html5/unnamed-chunk-30-1.png","lecture_8_files/figure-html5/unnamed-chunk-32-1.png","lecture_8_files/figure-html5/unnamed-chunk-34-1.png","lecture_8_files/figure-html5/unnamed-chunk-35-1.png","lecture_8_files/figure-html5/unnamed-chunk-37-1.png","lecture_8_files/figure-html5/unnamed-chunk-39-1.png","lecture_8_files/figure-html5/unnamed-chunk-42-1.png","lecture_8_files/figure-html5/unnamed-chunk-45-1.png","lecture_8_files/figure-html5/unnamed-chunk-47-1.png","lecture_8_files/figure-html5/unnamed-chunk-48-1.png","lecture_8_files/figure-html5/unnamed-chunk-49-1.png","lecture_8_files/figure-html5/unnamed-chunk-51-1.png","lecture_8_files/figure-html5/unnamed-chunk-52-1.png","lecture_8_files/figure-html5/unnamed-chunk-53-1.png","lecture_8_files/figure-html5/unnamed-chunk-54-1.png","lecture_8_files/figure-html5/unnamed-chunk-55-1.png","lecture_8_files/figure-html5/unnamed-chunk-59-1.png","lecture_8_files/figure-html5/unnamed-chunk-60-1.png","lecture_8_files/figure-html5/unnamed-chunk-61-1.png","lecture_8_files/figure-html5/unnamed-chunk-62-1.png","lecture_8_files/figure-html5/unnamed-chunk-69-1.png","lecture_8_files/figure-html5/unnamed-chunk-69-2.png","lecture_8_files/figure-html5/unnamed-chunk-69-3.png","lecture_8_files/figure-html5/unnamed-chunk-70-1.png","lecture_8_files/figure-html5/unnamed-chunk-70-2.png","lecture_8_files/figure-html5/unnamed-chunk-70-3.png","lecture_8_files/figure-html5/unnamed-chunk-77-1.png","lecture_8_files/figure-html5/unnamed-chunk-78-1.png","lecture_8_files/figure-html5/unnamed-chunk-79-1.png","lecture_8_files/figure-html5/unnamed-chunk-79-2.png","lecture_8_files/figure-html5/unnamed-chunk-80-1.png","lecture_8_files/figure-html5/unnamed-chunk-80-2.png","lecture_8_files/figure-html5/unnamed-chunk-82-1.png","lecture_8_files/figure-html5/unnamed-chunk-83-1.png","lecture_8_files/figure-html5/unnamed-chunk-84-1.png","lecture_8_files/figure-html5/unnamed-chunk-85-1.png","lecture_8_files/figure-html5/unnamed-chunk-88-1.png","lecture_8_files/figure-html5/unnamed-chunk-88-2.png","lecture_8_files/figure-html5/unnamed-chunk-88-3.png","lecture_8_files/figure-html5/unnamed-chunk-88-4.png","lecture_8_files/figure-html5/unnamed-chunk-89-1.png","lecture_8_files/figure-html5/unnamed-chunk-90-1.png","lecture_8_files/figure-html5/unnamed-chunk-90-2.png","lecture_8_files/figure-html5/unnamed-chunk-90-3.png","lecture_8_files/figure-html5/unnamed-chunk-90-4.png","lecture_8_files/figure-html5/unnamed-chunk-91-1.png","lecture_8_files/figure-html5/unnamed-chunk-91-2.png","lecture_8_files/figure-html5/unnamed-chunk-91-3.png","lecture_8_files/figure-html5/unnamed-chunk-91-4.png","lecture_8_files/figure-html5/unnamed-chunk-92-1.png","lecture_8_files/header-attrs-2.7.10/header-attrs.js","lecture_8_files/jquery-1.11.3/jquery.min.js","lecture_8_files/popper-2.6.0/popper.min.js","lecture_8_files/tippy-6.2.7/tippy-bundle.umd.min.js","lecture_8_files/tippy-6.2.7/tippy-light-border.css","lecture_8_files/tippy-6.2.7/tippy.css","lecture_8_files/tippy-6.2.7/tippy.umd.min.js","lecture_8_files/webcomponents-2.0.0/webcomponents.js","op.png","slides.log","slides.tex","theme.css"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
  <!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

  <style type="text/css">

  body {
    background-color: white;
  }

  .pandoc-table {
    width: 100%;
  }

  .pandoc-table>caption {
    margin-bottom: 10px;
  }

  .pandoc-table th:not([align]) {
    text-align: left;
  }

  .pagedtable-footer {
    font-size: 15px;
  }

  d-byline .byline {
    grid-template-columns: 2fr 2fr;
  }

  d-byline .byline h3 {
    margin-block-start: 1.5em;
  }

  d-byline .byline .authors-affiliations h3 {
    margin-block-start: 0.5em;
  }

  .authors-affiliations .orcid-id {
    width: 16px;
    height:16px;
    margin-left: 4px;
    margin-right: 4px;
    vertical-align: middle;
    padding-bottom: 2px;
  }

  d-title .dt-tags {
    margin-top: 1em;
    grid-column: text;
  }

  .dt-tags .dt-tag {
    text-decoration: none;
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0em 0.4em;
    margin-right: 0.5em;
    margin-bottom: 0.4em;
    font-size: 70%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  d-article table.gt_table td,
  d-article table.gt_table th {
    border-bottom: none;
  }

  .html-widget {
    margin-bottom: 2.0em;
  }

  .l-screen-inset {
    padding-right: 16px;
  }

  .l-screen .caption {
    margin-left: 10px;
  }

  .shaded {
    background: rgb(247, 247, 247);
    padding-top: 20px;
    padding-bottom: 20px;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .html-widget {
    margin-bottom: 0;
    border: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .shaded-content {
    background: white;
  }

  .text-output {
    margin-top: 0;
    line-height: 1.5em;
  }

  .hidden {
    display: none !important;
  }

  d-article {
    padding-top: 2.5rem;
    padding-bottom: 30px;
  }

  d-appendix {
    padding-top: 30px;
  }

  d-article>p>img {
    width: 100%;
  }

  d-article h2 {
    margin: 1rem 0 1.5rem 0;
  }

  d-article h3 {
    margin-top: 1.5rem;
  }

  d-article iframe {
    border: 1px solid rgba(0, 0, 0, 0.1);
    margin-bottom: 2.0em;
    width: 100%;
  }

  /* Tweak code blocks */

  d-article div.sourceCode code,
  d-article pre code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: auto;
  }

  d-article div.sourceCode {
    background-color: white;
  }

  d-article div.sourceCode pre {
    padding-left: 10px;
    font-size: 12px;
    border-left: 2px solid rgba(0,0,0,0.1);
  }

  d-article pre {
    font-size: 12px;
    color: black;
    background: none;
    margin-top: 0;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  d-article pre a {
    border-bottom: none;
  }

  d-article pre a:hover {
    border-bottom: none;
    text-decoration: underline;
  }

  d-article details {
    grid-column: text;
    margin-bottom: 0.8em;
  }

  @media(min-width: 768px) {

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: visible !important;
  }

  d-article div.sourceCode pre {
    padding-left: 18px;
    font-size: 14px;
  }

  d-article pre {
    font-size: 14px;
  }

  }

  figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  /* CSS for d-contents */

  .d-contents {
    grid-column: text;
    color: rgba(0,0,0,0.8);
    font-size: 0.9em;
    padding-bottom: 1em;
    margin-bottom: 1em;
    padding-bottom: 0.5em;
    margin-bottom: 1em;
    padding-left: 0.25em;
    justify-self: start;
  }

  @media(min-width: 1000px) {
    .d-contents.d-contents-float {
      height: 0;
      grid-column-start: 1;
      grid-column-end: 4;
      justify-self: center;
      padding-right: 3em;
      padding-left: 2em;
    }
  }

  .d-contents nav h3 {
    font-size: 18px;
    margin-top: 0;
    margin-bottom: 1em;
  }

  .d-contents li {
    list-style-type: none
  }

  .d-contents nav > ul {
    padding-left: 0;
  }

  .d-contents ul {
    padding-left: 1em
  }

  .d-contents nav ul li {
    margin-top: 0.6em;
    margin-bottom: 0.2em;
  }

  .d-contents nav a {
    font-size: 13px;
    border-bottom: none;
    text-decoration: none
    color: rgba(0, 0, 0, 0.8);
  }

  .d-contents nav a:hover {
    text-decoration: underline solid rgba(0, 0, 0, 0.6)
  }

  .d-contents nav > ul > li > a {
    font-weight: 600;
  }

  .d-contents nav > ul > li > ul {
    font-weight: inherit;
  }

  .d-contents nav > ul > li > ul > li {
    margin-top: 0.2em;
  }


  .d-contents nav ul {
    margin-top: 0;
    margin-bottom: 0.25em;
  }

  .d-article-with-toc h2:nth-child(2) {
    margin-top: 0;
  }


  /* Figure */

  .figure {
    position: relative;
    margin-bottom: 2.5em;
    margin-top: 1.5em;
  }

  .figure img {
    width: 100%;
  }

  .figure .caption {
    color: rgba(0, 0, 0, 0.6);
    font-size: 12px;
    line-height: 1.5em;
  }

  .figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  .figure .caption a {
    color: rgba(0, 0, 0, 0.6);
  }

  .figure .caption b,
  .figure .caption strong, {
    font-weight: 600;
    color: rgba(0, 0, 0, 1.0);
  }

  /* Citations */

  d-article .citation {
    color: inherit;
    cursor: inherit;
  }

  div.hanging-indent{
    margin-left: 1em; text-indent: -1em;
  }

  /* Citation hover box */

  .tippy-box[data-theme~=light-border] {
    background-color: rgba(250, 250, 250, 0.95);
  }

  .tippy-content > p {
    margin-bottom: 0;
    padding: 2px;
  }


  /* Tweak 1000px media break to show more text */

  @media(min-width: 1000px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 16px;
    }

    .grid {
      grid-column-gap: 16px;
    }

    d-article {
      font-size: 1.06rem;
      line-height: 1.7em;
    }
    figure .caption, .figure .caption, figure figcaption {
      font-size: 13px;
    }
  }

  @media(min-width: 1180px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 32px;
    }

    .grid {
      grid-column-gap: 32px;
    }
  }


  /* Get the citation styles for the appendix (not auto-injected on render since
     we do our own rendering of the citation appendix) */

  d-appendix .citation-appendix,
  .d-appendix .citation-appendix {
    font-size: 11px;
    line-height: 15px;
    border-left: 1px solid rgba(0, 0, 0, 0.1);
    padding-left: 18px;
    border: 1px solid rgba(0,0,0,0.1);
    background: rgba(0, 0, 0, 0.02);
    padding: 10px 18px;
    border-radius: 3px;
    color: rgba(150, 150, 150, 1);
    overflow: hidden;
    margin-top: -12px;
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  /* Include appendix styles here so they can be overridden */

  d-appendix {
    contain: layout style;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-top: 60px;
    margin-bottom: 0;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    color: rgba(0,0,0,0.5);
    padding-top: 60px;
    padding-bottom: 48px;
  }

  d-appendix h3 {
    grid-column: page-start / text-start;
    font-size: 15px;
    font-weight: 500;
    margin-top: 1em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.65);
  }

  d-appendix h3 + * {
    margin-top: 1em;
  }

  d-appendix ol {
    padding: 0 0 0 15px;
  }

  @media (min-width: 768px) {
    d-appendix ol {
      padding: 0 0 0 30px;
      margin-left: -30px;
    }
  }

  d-appendix li {
    margin-bottom: 1em;
  }

  d-appendix a {
    color: rgba(0, 0, 0, 0.6);
  }

  d-appendix > * {
    grid-column: text;
  }

  d-appendix > d-footnote-list,
  d-appendix > d-citation-list,
  d-appendix > distill-appendix {
    grid-column: screen;
  }

  /* Include footnote styles here so they can be overridden */

  d-footnote-list {
    contain: layout style;
  }

  d-footnote-list > * {
    grid-column: text;
  }

  d-footnote-list a.footnote-backlink {
    color: rgba(0,0,0,0.3);
    padding-left: 0.5em;
  }



  /* Anchor.js */

  .anchorjs-link {
    /*transition: all .25s linear; */
    text-decoration: none;
    border-bottom: none;
  }
  *:hover > .anchorjs-link {
    margin-left: -1.125em !important;
    text-decoration: none;
    border-bottom: none;
  }

  /* Social footer */

  .social_footer {
    margin-top: 30px;
    margin-bottom: 0;
    color: rgba(0,0,0,0.67);
  }

  .disqus-comments {
    margin-right: 30px;
  }

  .disqus-comment-count {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
    cursor: pointer;
  }

  #disqus_thread {
    margin-top: 30px;
  }

  .article-sharing a {
    border-bottom: none;
    margin-right: 8px;
  }

  .article-sharing a:hover {
    border-bottom: none;
  }

  .sidebar-section.subscribe {
    font-size: 12px;
    line-height: 1.6em;
  }

  .subscribe p {
    margin-bottom: 0.5em;
  }


  .article-footer .subscribe {
    font-size: 15px;
    margin-top: 45px;
  }


  .sidebar-section.custom {
    font-size: 12px;
    line-height: 1.6em;
  }

  .custom p {
    margin-bottom: 0.5em;
  }

  /* Styles for listing layout (hide title) */
  .layout-listing d-title, .layout-listing .d-title {
    display: none;
  }

  /* Styles for posts lists (not auto-injected) */


  .posts-with-sidebar {
    padding-left: 45px;
    padding-right: 45px;
  }

  .posts-list .description h2,
  .posts-list .description p {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  }

  .posts-list .description h2 {
    font-weight: 700;
    border-bottom: none;
    padding-bottom: 0;
  }

  .posts-list h2.post-tag {
    border-bottom: 1px solid rgba(0, 0, 0, 0.2);
    padding-bottom: 12px;
  }
  .posts-list {
    margin-top: 60px;
    margin-bottom: 24px;
  }

  .posts-list .post-preview {
    text-decoration: none;
    overflow: hidden;
    display: block;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    padding: 24px 0;
  }

  .post-preview-last {
    border-bottom: none !important;
  }

  .posts-list .posts-list-caption {
    grid-column: screen;
    font-weight: 400;
  }

  .posts-list .post-preview h2 {
    margin: 0 0 6px 0;
    line-height: 1.2em;
    font-style: normal;
    font-size: 24px;
  }

  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.4em;
    font-size: 16px;
  }

  .posts-list .post-preview .thumbnail {
    box-sizing: border-box;
    margin-bottom: 24px;
    position: relative;
    max-width: 500px;
  }
  .posts-list .post-preview img {
    width: 100%;
    display: block;
  }

  .posts-list .metadata {
    font-size: 12px;
    line-height: 1.4em;
    margin-bottom: 18px;
  }

  .posts-list .metadata > * {
    display: inline-block;
  }

  .posts-list .metadata .publishedDate {
    margin-right: 2em;
  }

  .posts-list .metadata .dt-authors {
    display: block;
    margin-top: 0.3em;
    margin-right: 2em;
  }

  .posts-list .dt-tags {
    display: block;
    line-height: 1em;
  }

  .posts-list .dt-tags .dt-tag {
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0.3em 0.4em;
    margin-right: 0.2em;
    margin-bottom: 0.4em;
    font-size: 60%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  .posts-list img {
    opacity: 1;
  }

  .posts-list img[data-src] {
    opacity: 0;
  }

  .posts-more {
    clear: both;
  }


  .posts-sidebar {
    font-size: 16px;
  }

  .posts-sidebar h3 {
    font-size: 16px;
    margin-top: 0;
    margin-bottom: 0.5em;
    font-weight: 400;
    text-transform: uppercase;
  }

  .sidebar-section {
    margin-bottom: 30px;
  }

  .categories ul {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }

  .categories li {
    color: rgba(0, 0, 0, 0.8);
    margin-bottom: 0;
  }

  .categories li>a {
    border-bottom: none;
  }

  .categories li>a:hover {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  }

  .categories .active {
    font-weight: 600;
  }

  .categories .category-count {
    color: rgba(0, 0, 0, 0.4);
  }


  @media(min-width: 768px) {
    .posts-list .post-preview h2 {
      font-size: 26px;
    }
    .posts-list .post-preview .thumbnail {
      float: right;
      width: 30%;
      margin-bottom: 0;
    }
    .posts-list .post-preview .description {
      float: left;
      width: 45%;
    }
    .posts-list .post-preview .metadata {
      float: left;
      width: 20%;
      margin-top: 8px;
    }
    .posts-list .post-preview p {
      margin: 0 0 12px 0;
      line-height: 1.5em;
      font-size: 16px;
    }
    .posts-with-sidebar .posts-list {
      float: left;
      width: 75%;
    }
    .posts-with-sidebar .posts-sidebar {
      float: right;
      width: 20%;
      margin-top: 60px;
      padding-top: 24px;
      padding-bottom: 24px;
    }
  }


  /* Improve display for browsers without grid (IE/Edge <= 15) */

  .downlevel {
    line-height: 1.6em;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
    margin: 0;
  }

  .downlevel .d-title {
    padding-top: 6rem;
    padding-bottom: 1.5rem;
  }

  .downlevel .d-title h1 {
    font-size: 50px;
    font-weight: 700;
    line-height: 1.1em;
    margin: 0 0 0.5rem;
  }

  .downlevel .d-title p {
    font-weight: 300;
    font-size: 1.2rem;
    line-height: 1.55em;
    margin-top: 0;
  }

  .downlevel .d-byline {
    padding-top: 0.8em;
    padding-bottom: 0.8em;
    font-size: 0.8rem;
    line-height: 1.8em;
  }

  .downlevel .section-separator {
    border: none;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
  }

  .downlevel .d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
    padding-top: 1rem;
    padding-bottom: 2rem;
  }


  .downlevel .d-appendix {
    padding-left: 0;
    padding-right: 0;
    max-width: none;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.5);
    padding-top: 40px;
    padding-bottom: 48px;
  }

  .downlevel .footnotes ol {
    padding-left: 13px;
  }

  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
    padding-left: 40px;
    padding-right: 40px;
  }

  @media(min-width: 768px) {
    .downlevel .base-grid,
    .downlevel .distill-header,
    .downlevel .d-title,
    .downlevel .d-abstract,
    .downlevel .d-article,
    .downlevel .d-appendix,
    .downlevel .distill-appendix,
    .downlevel .d-byline,
    .downlevel .d-footnote-list,
    .downlevel .d-citation-list,
    .downlevel .distill-footer,
    .downlevel .appendix-bottom,
    .downlevel .posts-container {
    padding-left: 150px;
    padding-right: 150px;
    max-width: 900px;
  }
  }

  .downlevel pre code {
    display: block;
    border-left: 2px solid rgba(0, 0, 0, .1);
    padding: 0 0 0 20px;
    font-size: 14px;
  }

  .downlevel code, .downlevel pre {
    color: black;
    background: none;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  .downlevel .posts-list .post-preview {
    color: inherit;
  }



  </style>

  <script type="application/javascript">

  function is_downlevel_browser() {
    if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                   window.navigator.userAgent)) {
      return true;
    } else {
      return window.load_distill_framework === undefined;
    }
  }

  // show body when load is complete
  function on_load_complete() {

    // add anchors
    if (window.anchors) {
      window.anchors.options.placement = 'left';
      window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
    }


    // set body to visible
    document.body.style.visibility = 'visible';

    // force redraw for leaflet widgets
    if (window.HTMLWidgets) {
      var maps = window.HTMLWidgets.findAll(".leaflet");
      $.each(maps, function(i, el) {
        var map = this.getMap();
        map.invalidateSize();
        map.eachLayer(function(layer) {
          if (layer instanceof L.TileLayer)
            layer.redraw();
        });
      });
    }

    // trigger 'shown' so htmlwidgets resize
    $('d-article').trigger('shown');
  }

  function init_distill() {

    init_common();

    // create front matter
    var front_matter = $('<d-front-matter></d-front-matter>');
    $('#distill-front-matter').wrap(front_matter);

    // create d-title
    $('.d-title').changeElementType('d-title');

    // create d-byline
    var byline = $('<d-byline></d-byline>');
    $('.d-byline').replaceWith(byline);

    // create d-article
    var article = $('<d-article></d-article>');
    $('.d-article').wrap(article).children().unwrap();

    // move posts container into article
    $('.posts-container').appendTo($('d-article'));

    // create d-appendix
    $('.d-appendix').changeElementType('d-appendix');

    // flag indicating that we have appendix items
    var appendix = $('.appendix-bottom').children('h3').length > 0;

    // replace footnotes with <d-footnote>
    $('.footnote-ref').each(function(i, val) {
      appendix = true;
      var href = $(this).attr('href');
      var id = href.replace('#', '');
      var fn = $('#' + id);
      var fn_p = $('#' + id + '>p');
      fn_p.find('.footnote-back').remove();
      var text = fn_p.html();
      var dtfn = $('<d-footnote></d-footnote>');
      dtfn.html(text);
      $(this).replaceWith(dtfn);
    });
    // remove footnotes
    $('.footnotes').remove();

    // move refs into #references-listing
    $('#references-listing').replaceWith($('#refs'));

    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      var id = $(this).attr('id');
      $('.d-contents a[href="#' + id + '"]').parent().remove();
      appendix = true;
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
    });

    // show d-appendix if we have appendix content
    $("d-appendix").css('display', appendix ? 'grid' : 'none');

    // localize layout chunks to just output
    $('.layout-chunk').each(function(i, val) {

      // capture layout
      var layout = $(this).attr('data-layout');

      // apply layout to markdown level block elements
      var elements = $(this).children().not('details, div.sourceCode, pre, script');
      elements.each(function(i, el) {
        var layout_div = $('<div class="' + layout + '"></div>');
        if (layout_div.hasClass('shaded')) {
          var shaded_content = $('<div class="shaded-content"></div>');
          $(this).wrap(shaded_content);
          $(this).parent().wrap(layout_div);
        } else {
          $(this).wrap(layout_div);
        }
      });


      // unwrap the layout-chunk div
      $(this).children().unwrap();
    });

    // remove code block used to force  highlighting css
    $('.distill-force-highlighting-css').parent().remove();

    // remove empty line numbers inserted by pandoc when using a
    // custom syntax highlighting theme
    $('code.sourceCode a:empty').remove();

    // load distill framework
    load_distill_framework();

    // wait for window.distillRunlevel == 4 to do post processing
    function distill_post_process() {

      if (!window.distillRunlevel || window.distillRunlevel < 4)
        return;

      // hide author/affiliations entirely if we have no authors
      var front_matter = JSON.parse($("#distill-front-matter").html());
      var have_authors = front_matter.authors && front_matter.authors.length > 0;
      if (!have_authors)
        $('d-byline').addClass('hidden');

      // article with toc class
      $('.d-contents').parent().addClass('d-article-with-toc');

      // strip links that point to #
      $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

      // add orcid ids
      $('.authors-affiliations').find('.author').each(function(i, el) {
        var orcid_id = front_matter.authors[i].orcidID;
        if (orcid_id) {
          var a = $('<a></a>');
          a.attr('href', 'https://orcid.org/' + orcid_id);
          var img = $('<img></img>');
          img.addClass('orcid-id');
          img.attr('alt', 'ORCID ID');
          img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
          a.append(img);
          $(this).append(a);
        }
      });

      // hide elements of author/affiliations grid that have no value
      function hide_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
      }

      // affiliations
      var have_affiliations = false;
      for (var i = 0; i<front_matter.authors.length; ++i) {
        var author = front_matter.authors[i];
        if (author.affiliation !== "&nbsp;") {
          have_affiliations = true;
          break;
        }
      }
      if (!have_affiliations)
        $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

      // published date
      if (!front_matter.publishedDate)
        hide_byline_column("Published");

      // document object identifier
      var doi = $('d-byline').find('h3:contains("DOI")');
      var doi_p = doi.next().empty();
      if (!front_matter.doi) {
        // if we have a citation and valid citationText then link to that
        if ($('#citation').length > 0 && front_matter.citationText) {
          doi.html('Citation');
          $('<a href="#citation"></a>')
            .text(front_matter.citationText)
            .appendTo(doi_p);
        } else {
          hide_byline_column("DOI");
        }
      } else {
        $('<a></a>')
           .attr('href', "https://doi.org/" + front_matter.doi)
           .html(front_matter.doi)
           .appendTo(doi_p);
      }

       // change plural form of authors/affiliations
      if (front_matter.authors.length === 1) {
        var grid = $('.authors-affiliations');
        grid.children('h3:contains("Authors")').text('Author');
        grid.children('h3:contains("Affiliations")').text('Affiliation');
      }

      // remove d-appendix and d-footnote-list local styles
      $('d-appendix > style:first-child').remove();
      $('d-footnote-list > style:first-child').remove();

      // move appendix-bottom entries to the bottom
      $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
      $('.appendix-bottom').remove();

      // hoverable references
      $('span.citation[data-cites]').each(function() {
        var refHtml = $('#ref-' + $(this).attr('data-cites')).html();
        window.tippy(this, {
          allowHTML: true,
          content: refHtml,
          maxWidth: 500,
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start'
        });
      });

      // clear polling timer
      clearInterval(tid);

      // show body now that everything is ready
      on_load_complete();
    }

    var tid = setInterval(distill_post_process, 50);
    distill_post_process();

  }

  function init_downlevel() {

    init_common();

     // insert hr after d-title
    $('.d-title').after($('<hr class="section-separator"/>'));

    // check if we have authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;

    // manage byline/border
    if (!have_authors)
      $('.d-byline').remove();
    $('.d-byline').after($('<hr class="section-separator"/>'));
    $('.d-byline a').remove();

    // remove toc
    $('.d-contents').remove();

    // move appendix elements
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
    });


    // inject headers into references and footnotes
    var refs_header = $('<h3></h3>');
    refs_header.text('References');
    $('#refs').prepend(refs_header);

    var footnotes_header = $('<h3></h3');
    footnotes_header.text('Footnotes');
    $('.footnotes').children('hr').first().replaceWith(footnotes_header);

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // remove appendix if it's empty
    if ($('.d-appendix').children().length === 0)
      $('.d-appendix').remove();

    // prepend separator above appendix
    $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

    // trim code
    $('pre>code').each(function(i, val) {
      $(this).html($.trim($(this).html()));
    });

    // move posts-container right before article
    $('.posts-container').insertBefore($('.d-article'));

    $('body').addClass('downlevel');

    on_load_complete();
  }


  function init_common() {

    // jquery plugin to change element types
    (function($) {
      $.fn.changeElementType = function(newType) {
        var attrs = {};

        $.each(this[0].attributes, function(idx, attr) {
          attrs[attr.nodeName] = attr.nodeValue;
        });

        this.replaceWith(function() {
          return $("<" + newType + "/>", attrs).append($(this).contents());
        });
      };
    })(jQuery);

    // prevent underline for linked images
    $('a > img').parent().css({'border-bottom' : 'none'});

    // mark non-body figures created by knitr chunks as 100% width
    $('.layout-chunk').each(function(i, val) {
      var figures = $(this).find('img, .html-widget');
      if ($(this).attr('data-layout') !== "l-body") {
        figures.css('width', '100%');
      } else {
        figures.css('max-width', '100%');
        figures.filter("[width]").each(function(i, val) {
          var fig = $(this);
          fig.css('width', fig.attr('width') + 'px');
        });

      }
    });

    // auto-append index.html to post-preview links in file: protocol
    // and in rstudio ide preview
    $('.post-preview').each(function(i, val) {
      if (window.location.protocol === "file:")
        $(this).attr('href', $(this).attr('href') + "index.html");
    });

    // get rid of index.html references in header
    if (window.location.protocol !== "file:") {
      $('.distill-site-header a[href]').each(function(i,val) {
        $(this).attr('href', $(this).attr('href').replace("index.html", "./"));
      });
    }

    // add class to pandoc style tables
    $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
    $('.kable-table').children('table').addClass('pandoc-table');

    // add figcaption style to table captions
    $('caption').parent('table').addClass("figcaption");

    // initialize posts list
    if (window.init_posts_list)
      window.init_posts_list();

    // implmement disqus comment link
    $('.disqus-comment-count').click(function() {
      window.headroom_prevent_pin = true;
      $('#disqus_thread').toggleClass('hidden');
      if (!$('#disqus_thread').hasClass('hidden')) {
        var offset = $(this).offset();
        $(window).resize();
        $('html, body').animate({
          scrollTop: offset.top - 35
        });
      }
    });
  }

  document.addEventListener('DOMContentLoaded', function() {
    if (is_downlevel_browser())
      init_downlevel();
    else
      window.addEventListener('WebComponentsReady', init_distill);
  });

  </script>

  <!--/radix_placeholder_distill-->
  <script src="lecture_8_files/header-attrs-2.7.10/header-attrs.js"></script>
  <script src="lecture_8_files/jquery-1.11.3/jquery.min.js"></script>
  <script src="lecture_8_files/popper-2.6.0/popper.min.js"></script>
  <link href="lecture_8_files/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="lecture_8_files/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="lecture_8_files/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="lecture_8_files/anchor-4.2.2/anchor.min.js"></script>
  <script src="lecture_8_files/bowser-1.9.3/bowser.min.js"></script>
  <script src="lecture_8_files/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="lecture_8_files/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
  <!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Generalised linear models","description":"Estimating binary responses, counts, rates, overdispersion, and zero-inflation","authors":[{"author":"Joseph Bulbulia","authorURL":"https://josephbulbulia.netlify.app","affiliation":"Victoria University of Wellington","affiliationURL":"https://www.wgtn.ac.nz","orcidID":"0000-0002-5861-2056"}],"publishedDate":"2021-04-27T00:00:00.000+00:00","citationText":"Bulbulia, 2021"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Generalised linear models</h1>
<!--radix_placeholder_categories-->
<!--/radix_placeholder_categories-->
<p>Estimating binary responses, counts, rates, overdispersion, and zero-inflation</p>
</div>

<div class="d-byline">
  Joseph Bulbulia <a href="https://josephbulbulia.netlify.app" class="uri">https://josephbulbulia.netlify.app</a> (Victoria University of Wellington)<a href="https://www.wgtn.ac.nz" class="uri">https://www.wgtn.ac.nz</a>
  
<br/>2021-APRIL-27
</div>

<div class="d-article">
<div class="d-contents d-contents-float">
<nav class="l-text toc figcaption" id="TOC">
<h3>Contents</h3>
<ul>
<li><a href="#objectives">Objectives</a></li>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#a-regression-model-implies-a-link-function">A regression model implies a ‘link’ function</a></li>
<li><a href="#logistic-regression">Logistic regression</a>
<ul>
<li><a href="#link-function-for-logistic-regression">Link function for logistic regression</a></li>
<li><a href="#extimating-the-probability-of-home-ownership-in-the-population">Extimating the probability of home ownership in the population</a></li>
<li><a href="#intepretation">Intepretation</a></li>
</ul></li>
<li><a href="#logistic-regression-with-a-single-co-variate.">Logistic regression with a single co-variate.</a>
<ul>
<li><a href="#workflow-center-and-scale-continuous-predictors">Workflow: center and scale continuous predictors</a></li>
<li><a href="#model-syntax">Model syntax</a></li>
<li><a href="#interpretation">Interpretation</a></li>
<li><a href="#workflow-graph-your-results.">Workflow: graph your results.</a></li>
<li><a href="#logistic-regression-with-a-categorical-covariate">Logistic regression with a categorical covariate</a></li>
<li><a href="#notes">Notes</a></li>
</ul></li>
<li><a href="#poisson-regression-counts">Poisson regression (counts)</a>
<ul>
<li><a href="#link-function-for-poisson-regression">Link function for poisson regression</a></li>
<li><a href="#model-checks">Model checks</a></li>
</ul></li>
<li><a href="#negative-binomial-models-over-dispersed-poissons">Negative binomial models (over-dispersed Poissons)</a>
<ul>
<li><a href="#link-function-for-a-negative-binomial-model">Link function for a negative binomial model</a></li>
</ul></li>
<li><a href="#zero-inflated-poisson-neg-binomial-regression">Zero-inflated poisson/ neg binomial regression</a>
<ul>
<li><a href="#link-function-for-zero-inflated-poisson">Link function for zero-inflated poisson</a></li>
<li><a href="#model-syntax-1">Model syntax</a></li>
<li><a href="#predicting-zeros">Predicting zeros</a></li>
<li><a href="#interpretation-1">Interpretation</a></li>
</ul></li>
<li><a href="#reporting">Reporting</a></li>
<li><a href="#summary">Summary</a></li>
<li><a href="#appendix-1">Appendix 1</a></li>
<li><a href="#appendix-2">Appendix 2</a></li>
<li><a href="#appendix-3">Appendix 3</a></li>
<li><a href="#acknowledgments-and-references">Acknowledgments and References</a></li>
</ul>
</nav>
</div>
<div class="layout-chunk" data-layout="l-body-outset">

</div>
<div class="layout-chunk" data-layout="l-body-outset">
<p><img src="op.png" width="500" /></p>
</div>
<h2 id="objectives">Objectives</h2>
<ol type="1">
<li>To understand the concept of a “generalised linear model,” and why the standard (gaussian) linear model is a special case.</li>
<li>To undertand how to write four classes of generalised linear models:</li>
</ol>
<ul>
<li>Logistic regression models, which apply to <em>binary</em> responses;</li>
<li>Poisson regression models, which apply to <em>rates</em>;</li>
<li>Negative binomial models (over-dispersed poisson regression models)</li>
<li>Zero-inflated poisson/negative binomial models, in which rates contain an over abundance of zeros.</li>
</ul>
<ol start="3" type="1">
<li>To understand how to interpret and report the results of a generalised linear model.</li>
</ol>
<!-- -   Ordinal regression model, which apply to data with multi-nomial outcomes, for example survey responses (e.g. "little", "none", "more"). Here we will also discuss monotonic predictors. -->
<h2 id="introduction">Introduction</h2>
<p>Recall that a regression model combines data from a sample, on the one hand, with the tools of probability theory, on the other hand, to infer features of an unobserved population. We call these unobserved features “parameters.” The task in regression is to estimate uncertainty in these parameters, and where possible, to narrow the bandwidth of such uncertainty. In a nutshell, regression is educated guesswork.</p>
<p>Our focus has been on teaching workflows for estimation that are grounding in three imperatives:</p>
<ol type="1">
<li>to clarify our question: what do we want to infer?</li>
<li>to clarify our assumptions: what do we believe about the world and our data before estimation gets going</li>
<li>to clarify our decisions: inevitably applied regression modelers must make choices: what have we decided and why?</li>
</ol>
<p>So far, our models have assumed that response data in our models are sampling from a “normal” or “gaussian” distribution. This assumption is useful because we live i an ordered universe from which many of our observations are sampling from a normal distribution. However, although the gaussian distribution is sensible choice for estimating many parameters it is not a sensible choice for estimating all parameters. The linear regression model that we have been using is really a special case of the generalised linear regression model. Today we introduce the generalised linear model.</p>
<h2 id="a-regression-model-implies-a-link-function">A regression model implies a ‘link’ function</h2>
<p>So far, we have written the gaussian linear model as:</p>
<p><span class="math display">\[ y_i  = \alpha + \beta x_i + e\]</span></p>
<p>Where y is the response for the i<span class="math inline">\({^th}\)</span> data point, <span class="math inline">\(\alpha\)</span> is the intercept, or the expected response for the population when all other regression coefficients are set to zero, <span class="math inline">\(\beta\)</span> is the adjustment in this expectation for the i<span class="math inline">\(^{th}\)</span> predictor <span class="math inline">\(x\)</span> associated with <span class="math inline">\(y_i\)</span>, where both y and x are random variables.</p>
<p>Often applied regression models were use compact matrix notation, where a bolded symbol is short hand for a matrix:</p>
<p><span class="math display">\[\boldsymbol{\eta} =  \boldsymbol{\alpha} + \boldsymbol{X}\boldsymbol{\beta}\\\]</span></p>
<p>For example here, <span class="math display">\[\boldsymbol{X}\boldsymbol{\beta}\\\]</span> is shorthand for <span class="math display">\[\beta_1X_i + \beta_2X_i + \beta_2X \dots\]</span></p>
<p>We can write the gaussian linear model in way that makes our assumptions and decisions explicit about what we think/hope it is doing when combining data with probability theory to estimate unknown (and inherently uncertain) parameters.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<p>Recall that there are two parameters that we need to estimate for gaussian linear model: the mean, and the variance.</p>
<p><span class="math display">\[
y_i \sim Normal ( \mu_i, \sigma)\\
\mu_i \sim \alpha + \beta x_i \\
\sigma \sim Exponentional (1) \\
\]</span></p>
<p>We assume that our response variable is a random variable that is sampling from a normal distribution with that has a mean <span class="math inline">\(\mu_i\)</span> and a variance <span class="math inline">\(\sigma^2\)</span>. For reasons that will become clear in the final lecture, we will write the variance parameter as the square root of the variance parameter, <span class="math inline">\(\sigma\)</span> which is a standard deviation (see Appendix 3 .appendix3)</p>
<aside>
The exponential distribution has good properties for estimating the standard deviation of the mean:
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>exponential_distribution</span> <span class='op'>&lt;-</span> <span class='op'>(</span> <span class='fu'><a href='https://rdrr.io/r/stats/Exponential.html'>rexp</a></span><span class='op'>(</span><span class='fl'>1000</span>, <span class='fl'>1</span><span class='op'>)</span> <span class='op'>)</span> 
<span class='fu'><a href='https://rdrr.io/r/graphics/hist.html'>hist</a></span><span class='op'>(</span><span class='va'>exponential_distribution</span>, breaks <span class='op'>=</span> <span class='fl'>100</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="lecture_8_files/figure-html5/unnamed-chunk-1-1.png" width="1152" /></p>
</div>
see <a href="https://cran.r-project.org/web/packages/brms/vignettes/brms_distreg.html#zero-inflated-models">here</a>
</aside>
<p>Every linear model implies a ‘link’ function:</p>
<p><span class="math inline">\(g(\cdot)\)</span> = link function as well as an an inverse link function:</p>
<p><span class="math inline">\(h(\cdot) = g^-1(\cdot)\)</span> = inverse link function</p>
<p>Where <span class="math inline">\((\cdot)\)</span> is the linear predictor: <span class="math inline">\(\boldsymbol{\eta}\)</span></p>
<p>In the gaussian linear model we assume</p>
<p><span class="math display">\[g(\cdot) = h(\cdot)\]</span> That is, the link function is an <em>identity</em> function. This is a special case. In the remainder of the lecture we will explore different mapping from the expected outcome of a model and its linear predictors.</p>
<h2 id="logistic-regression">Logistic regression</h2>
<p>We begin with outcomes that are distributed as binary data. Consider home ownership in the <code>nz jitter dataset</code>:</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/hist.html'>hist</a></span><span class='op'>(</span><span class='va'>nz</span><span class='op'>$</span><span class='va'>HomeOwner</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="lecture_8_files/figure-html5/unnamed-chunk-2-1.png" width="1152" /></p>
</div>
<p>From the graph, we can see response distribution is fully bimodal (excluding the NAs).</p>
<h3 id="link-function-for-logistic-regression">Link function for logistic regression</h3>
<p>The binomial link function does two things:</p>
<ul>
<li>first, it maps the range <span class="math inline">\((0, 1)\)</span> to <span class="math inline">\(-(\infty, -\infty)\)</span>.</li>
<li>second, it maps these values back to the unit range (see: <span class="citation" data-cites="gelman2020"><a href="#ref-gelman2020" role="doc-biblioref">Gelman, Hill, and Vehtari</a> (<a href="#ref-gelman2020" role="doc-biblioref">2020</a>)</span> )</li>
</ul>
<p>The logistic function satisfies the first task:</p>
<p><span class="math display">\[logit(\cdot) = log_e\frac{p}{(1-p)}\]</span></p>
<p>The inverse logit functionsatisfies the second task:</p>
<p><span class="math display">\[logit^-1(\cdot) = log\frac{e^\cdot}{(1-e^\cdot)}\]</span></p>
<p>We can write this:</p>
<p><span class="math display">\[
\Pr(y_i = 1) = p_i \\
logit(p_i) = \alpha + \beta x_i \\
\Pr(y_i = 1) = logit^{-1}(\alpha + \beta x_i)
\]</span> In R these functions are written:</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>logit</span> <span class='op'>&lt;-</span> <span class='va'>qlogis</span> 
<span class='va'>invlogit</span> <span class='op'>&lt;-</span> <span class='va'>plogis</span>
</code></pre>
</div>
</div>
<p>For logistic regression, the functions are employed as follow:</p>
<p><span class="math display">\[
\Pr(y_i = 1) = p_i \\
logit(p_i) = \alpha + \beta x_i \\
\Pr(y_i = 1) = logit^{-1}(\alpha + \beta x_i)
\]</span></p>
<p>Aside: later on we will express paramters for the linear predictors, so something like:</p>
<p><span class="math display">\[Home_i \sim binomial (Ownership_i, Pr)\\
Ownersip_i \sim mu_i \\
mu_i = \alpha + \beta X_i \\
\alpha ~ N(0,\sigma_{alpha})\\
\sigma_{alpha} \sim(0,10) \\
\beta \sim lognormal(0,1) \\
\]</span></p>
<p>Where the values we assign correspond to a range of expectations bout how the world might be. Let’s not get distracted with these details for now, however, I include them to give you a sense of how notation can help us to clarify our assumptions and decisions – which recall are essential navigations points for applied scientists.</p>
<h3 id="extimating-the-probability-of-home-ownership-in-the-population">Extimating the probability of home ownership in the population</h3>
<p>We can write a generalised linear model that predict home ownership as follows:</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>home</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/glm.html'>glm</a></span><span class='op'>(</span><span class='va'>HomeOwner</span> <span class='op'>~</span> <span class='fl'>1</span>, data <span class='op'>=</span> <span class='va'>nz</span>, 
            family <span class='op'>=</span> <span class='st'>"binomial"</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Which gives us the following result</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>parameters</span><span class='fu'>::</span><span class='fu'><a href='https://easystats.github.io/parameters/reference/model_parameters.html'>model_parameters</a></span><span class='op'>(</span><span class='va'>home</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>Parameter   | Log-Odds |   SE |       95% CI |     z |      p
-------------------------------------------------------------
(Intercept) |     1.46 | 0.05 | [1.36, 1.55] | 30.38 | &lt; .001</code></pre>
</div>
<p>Or plugging this into the equation:</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># this is how to quickly generate the equation</span>
<span class='fu'>equatiomatic</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/equatiomatic/man/extract_eq.html'>extract_eq</a></span><span class='op'>(</span><span class='va'>home</span>,  use_coefs <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
</code></pre>
</div>
<p><span class="math display">\[
\log\left[ \frac { \widehat{P( \operatorname{HomeOwner} = \operatorname{1} )} }{ 1 - \widehat{P( \operatorname{HomeOwner} = \operatorname{1} )} } \right] = 1.46
\]</span></p>
</div>
<h3 id="intepretation">Intepretation</h3>
<p>How do we interpret this result?</p>
<p>We can use the <code>plogis</code> function to obtain the probability</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/stats/Logistic.html'>plogis</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/coef.html'>coef</a></span><span class='op'>(</span><span class='va'>home</span><span class='op'>)</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 0.811068</code></pre>
</div>
<p>The probability of an NZAVS participant owning their own home is 0.811068</p>
<p>Notably, the logistic regression has estimated the sample mean to seven decimal places.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>nz</span><span class='op'>$</span><span class='va'>HomeOwner</span>, na.rm<span class='op'>=</span><span class='cn'>TRUE</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 0.811068</code></pre>
</div>
<h2 id="logistic-regression-with-a-single-co-variate.">Logistic regression with a single co-variate.</h2>
<h3 id="workflow-center-and-scale-continuous-predictors">Workflow: center and scale continuous predictors</h3>
<p>We do this as follows.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># work around for compatibility issue between ggeffects and dplyr. </span>
<span class='va'>nz</span><span class='op'>[</span><span class='st'>'Household.INC_s'</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/as.data.frame.html'>as.data.frame</a></span><span class='op'>(</span> <span class='fu'><a href='https://rdrr.io/r/base/scale.html'>scale</a></span><span class='op'>(</span><span class='va'>nz</span><span class='op'>$</span><span class='va'>Household.INC</span><span class='op'>)</span> <span class='op'>)</span>
</code></pre>
</div>
</div>
<p>To ge a reference point for a standard deviation of household income, let’s find the standard deviation for the sample:</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># how much is a standard deviation -- which will represent a 1 unit change for the regression coefficient? </span>
<span class='fu'><a href='https://rdrr.io/r/stats/sd.html'>sd</a></span><span class='op'>(</span> <span class='va'>nz</span><span class='op'>$</span><span class='va'>Household.INC</span>, na.rm <span class='op'>=</span> <span class='cn'>TRUE</span> <span class='op'>)</span> <span class='co'># 95,090</span>
</code></pre>
</div>
<pre><code>[1] 95090.79</code></pre>
</div>
<p>Let’s ask about the mean household for income in 2018?</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span> <span class='va'>nz</span><span class='op'>$</span><span class='va'>Household.INC</span>, na.rm <span class='op'>=</span> <span class='cn'>TRUE</span> <span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 112877.1</code></pre>
</div>
<h3 id="model-syntax">Model syntax</h3>
<p>We write a logistic regression model with a single covariate as follows:</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>home2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/glm.html'>glm</a></span><span class='op'>(</span><span class='va'>HomeOwner</span> <span class='op'>~</span> <span class='va'>Household.INC_s</span>, data <span class='op'>=</span> <span class='va'>nz</span>, 
            family <span class='op'>=</span> <span class='st'>"binomial"</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Results:</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>rs2</span><span class='op'>&lt;-</span><span class='fu'>parameters</span><span class='fu'>::</span><span class='fu'><a href='https://easystats.github.io/parameters/reference/model_parameters.html'>model_parameters</a></span><span class='op'>(</span><span class='va'>home2</span><span class='op'>)</span>
<span class='va'>rs2</span>
</code></pre>
</div>
<pre><code>Parameter       | Log-Odds |   SE |       95% CI |     z |      p
-----------------------------------------------------------------
(Intercept)     |     1.58 | 0.05 | [1.48, 1.69] | 29.37 | &lt; .001
Household.INC_s |     0.72 | 0.08 | [0.57, 0.89] |  8.86 | &lt; .001</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>rs2</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="lecture_8_files/figure-html5/unnamed-chunk-13-1.png" width="1152" /></p>
</div>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># this is how to quickly generate the equation</span>
<span class='fu'>equatiomatic</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/equatiomatic/man/extract_eq.html'>extract_eq</a></span><span class='op'>(</span><span class='va'>home2</span>,  use_coefs <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
</code></pre>
</div>
<p><span class="math display">\[
\log\left[ \frac { \widehat{P( \operatorname{HomeOwner} = \operatorname{1} )} }{ 1 - \widehat{P( \operatorname{HomeOwner} = \operatorname{1} )} } \right] = 1.58 + 0.72(\operatorname{Household.INC\_s})
\]</span></p>
</div>
<h3 id="interpretation">Interpretation</h3>
<p>How do we interpret this model?</p>
<p>Let’s use the report package</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>report</span><span class='fu'>::</span><span class='fu'><a href='https://easystats.github.io/report/reference/report.html'>report</a></span><span class='op'>(</span><span class='va'>home2</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>We fitted a logistic model (estimated using ML) to predict HomeOwner with Household.INC_s (formula: HomeOwner ~ Household.INC_s). The model&#39;s explanatory power is weak (Tjur&#39;s R2 = 0.04). The model&#39;s intercept, corresponding to Household.INC_s = 0, is at 1.58 (95% CI [1.48, 1.69], p &lt; .001). Within this model:

  - The effect of Household.INC_s is statistically significant and positive (beta = 0.72, 95% CI [0.57, 0.89], p &lt; .001; Std. beta = 0.73, 95% CI [0.57, 0.89])

Standardized parameters were obtained by fitting the model on a standardized version of the dataset. 95% Confidence Intervals (CIs) and p-values were computed using </code></pre>
</div>
<p>There’s lots of mention of p-values and power claims in the automated report, but what do these words practically mean?</p>
<h3 id="workflow-graph-your-results.">Workflow: graph your results.</h3>
<p>We are cultivating a habit of graphing our results. Let’s put this habit to virtuous use.</p>
<p>Here’s a shortcut for obtaining a quick, investigative plot:</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>nz</span><span class='op'>$</span><span class='va'>Household.INC_s</span>, <span class='va'>nz</span><span class='op'>$</span><span class='va'>HomeOwner</span><span class='op'>)</span> 
<span class='fu'><a href='https://rdrr.io/r/graphics/curve.html'>curve</a></span><span class='op'>(</span><span class='fu'>invlogit</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/coef.html'>coef</a></span><span class='op'>(</span><span class='va'>home2</span><span class='op'>)</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/stats/coef.html'>coef</a></span><span class='op'>(</span><span class='va'>home2</span><span class='op'>)</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span><span class='op'>*</span><span class='va'>x</span><span class='op'>)</span>, add<span class='op'>=</span><span class='cn'>TRUE</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="lecture_8_files/figure-html5/unnamed-chunk-16-1.png" width="1152" /></p>
</div>
<p>The slightly longer syntax for a ggeffects graph is:</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='fu'>ggeffects</span><span class='fu'>::</span><span class='fu'><a href='https://strengejacke.github.io/ggeffects/reference/ggpredict.html'>ggpredict</a></span><span class='op'>(</span><span class='va'>home2</span>, terms <span class='op'>=</span> <span class='st'>"Household.INC_s"</span><span class='op'>)</span>, add.data <span class='op'>=</span> <span class='cn'>TRUE</span>, alpha <span class='op'>=</span><span class='fl'>.1</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="lecture_8_files/figure-html5/unnamed-chunk-17-1.png" width="1152" /></p>
</div>
<p>And here we find a curious feature of our data. Income is diffuse. We have someone that makes over 25 standard deviations more than the average income.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/hist.html'>hist</a></span><span class='op'>(</span><span class='va'>nz</span><span class='op'>$</span><span class='va'>Household.INC</span>, breaks <span class='op'>=</span> <span class='fl'>1000</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="lecture_8_files/figure-html5/unnamed-chunk-18-1.png" width="1152" /></p>
</div>
<p>Although we graph home ownership, we forgot to graph Household income.</p>
<p><strong>Before launching into a model, your workflow should include graphing your predictors as well as your responses</strong></p>
<p>The range of incomes is: 0, 2.5^{6}.</p>
<p>Note that we also have 8 who report making less than 10000,</p>
<h4 id="sensitivity-of-the-data-to-outliers">Sensitivity of the data to outliers?</h4>
<p>Let’s re-run the model while eliminating the extremely rich, and restrict focus to 98% of the data. This restriction would appear to be justified. It would not be surprising if very rich people were to own their own homes.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Select 98 % of the range</span>
<span class='va'>nz2</span> <span class='op'>&lt;-</span>  <span class='va'>nz</span><span class='op'>%&gt;%</span>
  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>Household.INC_s</span> <span class='op'>&lt;</span> <span class='fl'>4</span><span class='op'>)</span>
<span class='co'>##</span>
<span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>nz2</span><span class='op'>)</span><span class='op'>/</span><span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>nz</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 0.979438</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>home2.1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/glm.html'>glm</a></span><span class='op'>(</span><span class='va'>HomeOwner</span> <span class='op'>~</span> <span class='va'>Household.INC_s</span>, data <span class='op'>=</span> <span class='va'>nz2</span>, 
            family <span class='op'>=</span> <span class='st'>"binomial"</span><span class='op'>)</span>
<span class='fu'>parameters</span><span class='fu'>::</span><span class='fu'><a href='https://easystats.github.io/parameters/reference/model_parameters.html'>model_parameters</a></span><span class='op'>(</span><span class='va'>home2.1</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>Parameter       | Log-Odds |   SE |       95% CI |     z |      p
-----------------------------------------------------------------
(Intercept)     |     1.60 | 0.05 | [1.50, 1.71] | 29.21 | &lt; .001
Household.INC_s |     0.78 | 0.08 | [0.62, 0.95] |  9.27 | &lt; .001</code></pre>
</div>
<p>Note that we need a sensible range. The lowest value is <strong>not</strong> 4 SD from the mean</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/hist.html'>hist</a></span><span class='op'>(</span><span class='va'>nz2</span><span class='op'>$</span><span class='va'>Household.INC_s</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="lecture_8_files/figure-html5/unnamed-chunk-21-1.png" width="1152" /></p>
</div>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/range.html'>range</a></span><span class='op'>(</span><span class='va'>nz2</span><span class='op'>$</span><span class='va'>Household.INC_s</span>, na.rm <span class='op'>=</span> <span class='cn'>T</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] -1.187046  3.755599</code></pre>
</div>
<p>Does this matter? Not necessarily. Linear regression does not require that the predictors sample from a normal distribution. This should be obvious, as we have used categorical predictors (e.g. Male/Not_Male). However it is worth explicitly stating. I have heard people who should know better express confusion on this point. Of course, that there are no parametric assumptions for your predictor variables does not let you off the hook. In this case, the extreme values might be distorting our inference.</p>
<p>Let’s write a model with the diminished dataset.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>#range(nz$Household.INC_s, na.rm = T)</span>

<span class='va'>mp2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='fu'>ggeffects</span><span class='fu'>::</span><span class='fu'><a href='https://strengejacke.github.io/ggeffects/reference/ggpredict.html'>ggpredict</a></span><span class='op'>(</span><span class='va'>home2</span>,
                                 terms <span class='op'>=</span> <span class='st'>"Household.INC_s[all]"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'>scale_y_continuous</span><span class='op'>(</span>limits <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_x_continuous</span><span class='op'>(</span>limits <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>1.2</span>, <span class='fl'>4</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>mp2.1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='fu'>ggeffects</span><span class='fu'>::</span><span class='fu'><a href='https://strengejacke.github.io/ggeffects/reference/ggpredict.html'>ggpredict</a></span><span class='op'>(</span><span class='va'>home2.1</span>,
                                   terms <span class='op'>=</span> <span class='st'>"Household.INC_s[all]"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'>scale_y_continuous</span><span class='op'>(</span>limits <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_x_continuous</span><span class='op'>(</span>limits <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>1.2</span>, <span class='fl'>4</span><span class='op'>)</span><span class='op'>)</span>

<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://patchwork.data-imaginist.com'>patchwork</a></span><span class='op'>)</span>
<span class='va'>mp2</span> <span class='op'>+</span> <span class='va'>mp2.1</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://patchwork.data-imaginist.com/reference/plot_annotation.html'>plot_annotation</a></span><span class='op'>(</span>title <span class='op'>=</span> <span class='st'>"Comparison of logistic regression models with tranformations"</span>,
                              tag_levels <span class='op'>=</span> <span class='st'>'a'</span><span class='op'>)</span> 
</code></pre>
</div>
<p><img src="lecture_8_files/figure-html5/unnamed-chunk-23-1.png" width="1152" /></p>
</div>
<p>Notice the trick that I used here:</p>
<p><code>scale_x_continuous(limits = c(-1.2, 4))</code></p>
<p>This code allowed me to constrain both graphs to the same x-axis scale. If I left this out the graphs would have looked like this:</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>#range(nz$Household.INC_s, na.rm = T)</span>

<span class='va'>mp2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='fu'>ggeffects</span><span class='fu'>::</span><span class='fu'><a href='https://strengejacke.github.io/ggeffects/reference/ggpredict.html'>ggpredict</a></span><span class='op'>(</span><span class='va'>home2</span>,
                                 terms <span class='op'>=</span> <span class='st'>"Household.INC_s[all]"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'>scale_y_continuous</span><span class='op'>(</span>limits <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span> 
<span class='va'>mp2.1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='fu'>ggeffects</span><span class='fu'>::</span><span class='fu'><a href='https://strengejacke.github.io/ggeffects/reference/ggpredict.html'>ggpredict</a></span><span class='op'>(</span><span class='va'>home2.1</span>,
                                   terms <span class='op'>=</span> <span class='st'>"Household.INC_s[all]"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'>scale_y_continuous</span><span class='op'>(</span>limits <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span> 

<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://patchwork.data-imaginist.com'>patchwork</a></span><span class='op'>)</span>
<span class='va'>mp2</span> <span class='op'>+</span> <span class='va'>mp2.1</span> <span class='op'>+</span> <span class='fu'><a href='https://patchwork.data-imaginist.com/reference/plot_annotation.html'>plot_annotation</a></span><span class='op'>(</span>title <span class='op'>=</span> <span class='st'>"Comparison of logistic regression models with tranformations"</span>,
                              tag_levels <span class='op'>=</span> <span class='st'>'a'</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://patchwork.data-imaginist.com/reference/plot_layout.html'>plot_layout</a></span><span class='op'>(</span>guides <span class='op'>=</span> <span class='st'>'collect'</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="lecture_8_files/figure-html5/unnamed-chunk-24-1.png" width="1152" /></p>
</div>
<p>The models are for all intents and purposes identical.</p>
<p>You can perform further checks using the following code, however, it should be apparent from the preceding graph that the models two models do not vary.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>check1</span> <span class='op'>&lt;-</span> <span class='fu'>performance</span><span class='fu'>::</span><span class='fu'><a href='https://easystats.github.io/performance/reference/check_model.html'>check_model</a></span><span class='op'>(</span><span class='va'>home2</span><span class='op'>)</span>
<span class='va'>check1</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>check2</span> <span class='op'>&lt;-</span> <span class='fu'>performance</span><span class='fu'>::</span><span class='fu'><a href='https://easystats.github.io/performance/reference/check_model.html'>check_model</a></span><span class='op'>(</span><span class='va'>home2.1</span><span class='op'>)</span>
<span class='va'>check2</span>
</code></pre>
</div>
</div>
<p>Before leaving this example, what would an ordinary linear regression sampling from a normal distribution have returned?</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>home2LM</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/lm.html'>lm</a></span><span class='op'>(</span><span class='va'>HomeOwner</span> <span class='op'>~</span> <span class='va'>Household.INC_s</span>, data <span class='op'>=</span> <span class='va'>nz</span><span class='op'>)</span>
<span class='va'>home2LM_r</span> <span class='op'>&lt;-</span><span class='fu'>parameters</span><span class='fu'>::</span><span class='fu'><a href='https://easystats.github.io/parameters/reference/model_parameters.html'>model_parameters</a></span><span class='op'>(</span><span class='va'>home2LM</span><span class='op'>)</span>
<span class='va'>home2LM_r</span>
</code></pre>
</div>
<pre><code>Parameter       | Coefficient |       SE |       95% CI | t(2796) |      p
--------------------------------------------------------------------------
(Intercept)     |        0.81 | 7.27e-03 | [0.80, 0.83] |  111.88 | &lt; .001
Household.INC_s |        0.06 | 7.23e-03 | [0.04, 0.07] |    8.04 | &lt; .001</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>home2LM_r</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="lecture_8_files/figure-html5/unnamed-chunk-27-1.png" width="1152" /></p>
</div>
<p>Let’s graph the results and compare the</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>home2LM_p</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='fu'>ggeffects</span><span class='fu'>::</span><span class='fu'><a href='https://strengejacke.github.io/ggeffects/reference/ggpredict.html'>ggpredict</a></span><span class='op'>(</span><span class='va'>home2LM</span>,
                                   terms <span class='op'>=</span> <span class='st'>"Household.INC_s[all]"</span><span class='op'>)</span>,
                  add.data <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'>scale_y_continuous</span><span class='op'>(</span>limits <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>1.5</span><span class='op'>)</span><span class='op'>)</span>  <span class='op'>+</span>
  <span class='fu'>scale_x_continuous</span><span class='op'>(</span>limits <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>1.2</span>, <span class='fl'>4</span><span class='op'>)</span><span class='op'>)</span><span class='op'>+</span> <span class='fu'>theme_classic</span><span class='op'>(</span><span class='op'>)</span>
<span class='va'>home2LM_p</span>
</code></pre>
</div>
<img src="lecture_8_files/figure-html5/unnamed-chunk-28-1.png" width="1152" />
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r">
<span class='va'>home2_p</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='fu'>ggeffects</span><span class='fu'>::</span><span class='fu'><a href='https://strengejacke.github.io/ggeffects/reference/ggpredict.html'>ggpredict</a></span><span class='op'>(</span><span class='va'>home2</span>,
                                   terms <span class='op'>=</span> <span class='st'>"Household.INC_s[all]"</span><span class='op'>)</span>,
                  add.data <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'>scale_y_continuous</span><span class='op'>(</span>limits <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>1.5</span><span class='op'>)</span><span class='op'>)</span>  <span class='op'>+</span>
  <span class='fu'>scale_x_continuous</span><span class='op'>(</span>limits <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>1.2</span>, <span class='fl'>4</span><span class='op'>)</span><span class='op'>)</span>

<span class='va'>home2LM_p</span> <span class='op'>+</span> <span class='va'>home2_p</span> <span class='op'>+</span> <span class='fu'><a href='https://patchwork.data-imaginist.com/reference/plot_annotation.html'>plot_annotation</a></span><span class='op'>(</span>subtitle <span class='op'>=</span> <span class='st'>"Comparison of ordinary least squares regression \n (a) with logistic regression (b) reveals n\ impossible predictions for OLS"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://patchwork.data-imaginist.com/reference/plot_layout.html'>plot_layout</a></span><span class='op'>(</span>guides <span class='op'>=</span> <span class='st'>"collect"</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="lecture_8_files/figure-html5/unnamed-chunk-28-2.png" width="1152" /></p>
</div>
<h3 id="logistic-regression-with-a-categorical-covariate">Logistic regression with a categorical covariate</h3>
<p>Let’s use the <code>GenCohort</code> variable.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>mg1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/glm.html'>glm</a></span><span class='op'>(</span><span class='va'>HomeOwner</span> <span class='op'>~</span> <span class='va'>GenCohort</span>, data <span class='op'>=</span> <span class='va'>nz</span>, family <span class='op'>=</span> <span class='st'>"binomial"</span><span class='op'>)</span>
<span class='fu'>parameters</span><span class='fu'>::</span><span class='fu'><a href='https://easystats.github.io/parameters/reference/model_parameters.html'>model_parameters</a></span><span class='op'>(</span><span class='va'>mg1</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>Parameter                               | Log-Odds |   SE |         95% CI |      z |      p
--------------------------------------------------------------------------------------------
(Intercept)                             |     2.13 | 0.10 | [ 1.94,  2.34] |  20.68 | &lt; .001
GenCohortGen_Silent *  born&lt; 1946       |     0.26 | 0.28 | [-0.26,  0.85] |   0.94 | 0.347 
GenCohortGenX *  born &gt;=1961 &amp; b.&lt; 1980 |    -0.62 | 0.13 | [-0.87, -0.38] |  -4.90 | &lt; .001
GenCohortGenY *  born &gt;=1980 &amp; b.&lt; 1996 |    -1.87 | 0.14 | [-2.15, -1.59] | -13.00 | &lt; .001
GenCohortGenZ *  born &gt;= 1996           |    -4.91 | 1.04 | [-7.80, -3.30] |  -4.74 | &lt; .001</code></pre>
</div>
<p>What does this mean? Let’s graph the results</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>p_mg1</span> <span class='op'>&lt;-</span><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='fu'>ggeffects</span><span class='fu'>::</span><span class='fu'><a href='https://strengejacke.github.io/ggeffects/reference/ggpredict.html'>ggpredict</a></span><span class='op'>(</span><span class='va'>mg1</span>, terms <span class='op'>=</span> <span class='st'>"GenCohort[all]"</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>p_mg1</span>
</code></pre>
</div>
<p><img src="lecture_8_files/figure-html5/unnamed-chunk-30-1.png" width="1152" /></p>
</div>
<p>Lets stratify by income</p>
<p>Household.INC_s</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>mg2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/glm.html'>glm</a></span><span class='op'>(</span><span class='va'>HomeOwner</span> <span class='op'>~</span> <span class='va'>GenCohort</span> <span class='op'>+</span> <span class='va'>Household.INC_s</span>, data <span class='op'>=</span> <span class='va'>nz</span>, family <span class='op'>=</span> <span class='st'>"binomial"</span><span class='op'>)</span>
<span class='fu'>parameters</span><span class='fu'>::</span><span class='fu'><a href='https://easystats.github.io/parameters/reference/model_parameters.html'>model_parameters</a></span><span class='op'>(</span><span class='va'>mg2</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>Parameter                               | Log-Odds |   SE |         95% CI |      z |      p
--------------------------------------------------------------------------------------------
(Intercept)                             |     2.60 | 0.12 | [ 2.37,  2.84] |  21.79 | &lt; .001
GenCohortGen_Silent *  born&lt; 1946       |     0.70 | 0.30 | [ 0.15,  1.33] |   2.35 | 0.019 
GenCohortGenX *  born &gt;=1961 &amp; b.&lt; 1980 |    -0.99 | 0.14 | [-1.26, -0.73] |  -7.31 | &lt; .001
GenCohortGenY *  born &gt;=1980 &amp; b.&lt; 1996 |    -2.40 | 0.16 | [-2.71, -2.09] | -14.94 | &lt; .001
GenCohortGenZ *  born &gt;= 1996           |    -4.99 | 1.06 | [-7.91, -3.32] |  -4.72 | &lt; .001
Household.INC_s                         |     1.19 | 0.10 | [ 0.99,  1.39] |  11.62 | &lt; .001</code></pre>
</div>
<p>We really don’t see income making a difference to home ownership for boomers. A little sepearation happens among those in Gen X.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>p_mg2</span> <span class='op'>&lt;-</span><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='fu'>ggeffects</span><span class='fu'>::</span><span class='fu'><a href='https://strengejacke.github.io/ggeffects/reference/ggpredict.html'>ggpredict</a></span><span class='op'>(</span><span class='va'>mg2</span>, terms <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"GenCohort[all]"</span>, <span class='st'>"Household.INC_s[c(-1,0,3)]"</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>p_mg2</span>
</code></pre>
</div>
<p><img src="lecture_8_files/figure-html5/unnamed-chunk-32-1.png" width="1152" /></p>
</div>
<h3 id="notes">Notes</h3>
<ul>
<li><p>Additive indicators on the logit scale are <em>non-linear</em> on the data scale. We see this in the previous graph. There’s a curve. This is typical of generalised linear models.</p></li>
<li><p>do not interpret the signs of the coefficients. For example, <code>plogis(-3)</code> is 0.0474259, which is a positive probability.</p></li>
<li><p>here are is no error term (<span class="math inline">\(\sigma^2\)</span>) in logistic regression. We only estimate the mean. The variances cannot be estimated:</p></li>
</ul>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>sjPlot</span><span class='fu'>::</span><span class='fu'><a href='https://strengejacke.github.io/sjPlot/reference/tab_model.html'>tab_model</a></span><span class='op'>(</span><span class='va'>home2</span><span class='op'>)</span>
</code></pre>
</div>
<table style="border-collapse:collapse; border:none;">
<tr>
<th style="border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm;  text-align:left; ">
 
</th>
<th colspan="3" style="border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm; ">
HomeOwner
</th>
</tr>
<tr>
<td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  text-align:left; ">
Predictors
</td>
<td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  ">
Odds Ratios
</td>
<td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  ">
CI
</td>
<td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  ">
p
</td>
</tr>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; ">
(Intercept)
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
4.87
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
4.39 – 5.43
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
<strong>&lt;0.001
</td>
</tr>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; ">
Household.INC_s
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
2.06
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
1.76 – 2.43
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
<strong>&lt;0.001
</td>
</tr>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm; border-top:1px solid;">
Observations
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left; border-top:1px solid;" colspan="3">
2798
</td>
</tr>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;">
R<sup>2</sup> Tjur
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="3">
0.036
</td>
</tr>
</table>
</div>
<ul>
<li>we can add points to our graph like this:</li>
</ul>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='fu'>ggeffects</span><span class='fu'>::</span><span class='fu'><a href='https://strengejacke.github.io/ggeffects/reference/ggpredict.html'>ggpredict</a></span><span class='op'>(</span><span class='va'>home2</span>, 
                     terms <span class='op'>=</span> <span class='st'>"Household.INC_s[all]"</span><span class='op'>)</span>, add.data <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'>scale_x_continuous</span><span class='op'>(</span>limits<span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>1.2</span>,<span class='fl'>4</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="lecture_8_files/figure-html5/unnamed-chunk-34-1.png" width="1152" /></p>
</div>
<p>Or to limit our points to the meaningful range:</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='fu'>ggeffects</span><span class='fu'>::</span><span class='fu'><a href='https://strengejacke.github.io/ggeffects/reference/ggpredict.html'>ggpredict</a></span><span class='op'>(</span><span class='va'>home2</span>, 
                     terms <span class='op'>=</span> <span class='st'>"Household.INC_s[all]"</span><span class='op'>)</span>, add.data <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'>scale_x_continuous</span><span class='op'>(</span>limits<span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>1.2</span>,<span class='fl'>4</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="lecture_8_files/figure-html5/unnamed-chunk-35-1.png" width="1152" /></p>
</div>
<ul>
<li>center (and where it eases interpretation, also scale) your predictor variables.</li>
</ul>
<p>Uncertainty arises because we only have 17 people in this jittered nz dataset born after 1996:</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span><span class='op'>(</span><span class='va'>nz</span><span class='op'>$</span><span class='va'>GenCohort</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>
Gen Boombers: born &gt;= 1946 &amp; b.&lt; 1961 
                                 1024 
               Gen_Silent: born&lt; 1946 
                                  208 
         GenX: born &gt;=1961 &amp; b.&lt; 1980 
                                 1253 
         GenY: born &gt;=1980 &amp; b.&lt; 1996 
                                  416 
                   GenZ: born &gt;= 1996 
                                   17 </code></pre>
</div>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>ggplot</span><span class='op'>(</span><span class='va'>nz</span>, <span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span><span class='va'>GenCohort</span>, <span class='va'>Household.INC</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'>geom_jitter</span><span class='op'>(</span>alpha <span class='op'>=</span> <span class='fl'>.5</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="lecture_8_files/figure-html5/unnamed-chunk-37-1.png" width="1152" /></p>
</div>
<p>Which model should we prefer?</p>
<p>The model <code>mg2</code> grealy improves on the BIC performance, indicating that we should prefer this model.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>per_home</span> <span class='op'>&lt;-</span><span class='fu'>performance</span><span class='fu'>::</span><span class='fu'><a href='https://easystats.github.io/performance/reference/compare_performance.html'>compare_performance</a></span><span class='op'>(</span><span class='va'>home2</span>,<span class='va'>mg1</span>,<span class='va'>mg2</span><span class='op'>)</span>
<span class='va'>per_home</span>
</code></pre>
</div>
<pre><code># Comparison of Model Performance Indices

Name  | Model |      AIC |      BIC | Tjur&#39;s R2 |  RMSE | Sigma | Log_loss | Score_log |   PCP | Score_spherical
----------------------------------------------------------------------------------------------------------------
home2 |   glm | 2590.320 | 2602.193 |     0.036 | 0.381 | 0.962 |    0.462 |      -Inf | 0.708 |                
mg1   |   glm | 2516.922 | 2546.675 |     0.099 | 0.372 | 0.941 |    0.442 |      -Inf | 0.724 |       3.915e-04
mg2   |   glm | 2272.307 | 2307.927 |     0.168 | 0.354 | 0.900 |    0.404 |      -Inf | 0.748 |       5.159e-04</code></pre>
</div>
<p>Here’s a graph:</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>per_home</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="lecture_8_files/figure-html5/unnamed-chunk-39-1.png" width="1152" /></p>
</div>
<p>Note that we do not include the model that used fewer cases because, from the vantage point of information theory, this would be comparing apples with organges.</p>
<p>We can use the performance package to check the accuracy of the our models</p>
<p>Compare:</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>performance_accuracy</span><span class='op'>(</span><span class='va'>mg1</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># Accuracy of Model Predictions

Accuracy: 66.40%
      SE: 3.78%-points
  Method: Area under Curve</code></pre>
</div>
<p>With:</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>performance_accuracy</span><span class='op'>(</span><span class='va'>mg2</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># Accuracy of Model Predictions

Accuracy: 76.85%
      SE: 2.23%-points
  Method: Area under Curve</code></pre>
</div>
<p>And this reveals little difference, indicating that with this many data, the outliers don’t affect inference.</p>
<h2 id="poisson-regression-counts">Poisson regression (counts)</h2>
<p>We use a poisson model for rates and counts</p>
<h3 id="link-function-for-poisson-regression">Link function for poisson regression</h3>
<p><span class="math display">\[
y_i \sim Poisson(\lambda_i)\\  
log(\lambda_i) = \alpha +\beta x_i\\
E(\lambda|y_i) = exp(\alpha +\beta x_i)
\]</span></p>
<p>Let’s simulate some data (example from <span class="citation" data-cites="gelman2020"><a href="#ref-gelman2020" role="doc-biblioref">Gelman, Hill, and Vehtari</a> (<a href="#ref-gelman2020" role="doc-biblioref">2020</a>)</span>, for more on simulated poisson variables go <a href="https://bookdown.org/rdpeng/rprogdatascience/simulation.html">here</a></p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>999</span><span class='op'>)</span>
<span class='va'>n</span> <span class='op'>&lt;-</span> <span class='fl'>50</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Uniform.html'>runif</a></span><span class='op'>(</span><span class='va'>n</span>, <span class='op'>-</span><span class='fl'>2</span>, <span class='fl'>2</span><span class='op'>)</span>
<span class='va'>a</span> <span class='op'>&lt;-</span> <span class='fl'>1</span>
<span class='va'>b</span> <span class='op'>&lt;-</span> <span class='fl'>2</span>
<span class='va'>out</span> <span class='op'>&lt;-</span> <span class='va'>a</span> <span class='op'>+</span> <span class='va'>b</span>  <span class='op'>*</span> <span class='va'>x</span>
<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>999</span><span class='op'>)</span>
<span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Poisson.html'>rpois</a></span><span class='op'>(</span><span class='va'>n</span>,  <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='va'>out</span><span class='op'>)</span><span class='op'>)</span> <span class='co'># mean of poisson is equal to its variance</span>
<span class='va'>fake</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>x<span class='op'>=</span><span class='va'>x</span>, y<span class='op'>=</span><span class='va'>y</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/hist.html'>hist</a></span><span class='op'>(</span><span class='va'>fake</span><span class='op'>$</span><span class='va'>y</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="lecture_8_files/figure-html5/unnamed-chunk-42-1.png" width="1152" /></p>
</div>
<p>Model</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>pois1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/glm.html'>glm</a></span><span class='op'>(</span><span class='va'>y</span> <span class='op'>~</span> <span class='va'>x</span>, data <span class='op'>=</span> <span class='va'>fake</span>, family <span class='op'>=</span> <span class='st'>"poisson"</span><span class='op'>)</span>
<span class='fu'>model_parameters</span><span class='op'>(</span><span class='va'>pois1</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>Parameter   | Log-Mean |   SE |       95% CI |     z |      p
-------------------------------------------------------------
(Intercept) |     1.01 | 0.11 | [0.79, 1.21] |  9.40 | &lt; .001
x           |     1.99 | 0.08 | [1.84, 2.14] | 26.24 | &lt; .001</code></pre>
</div>
<p>Note that in a poisson model, it is the log of the expected values (not the log of the raw data) that the model estimates:</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># this is how to quickly generate the equation</span>
<span class='fu'>equatiomatic</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/equatiomatic/man/extract_eq.html'>extract_eq</a></span><span class='op'>(</span><span class='va'>pois1</span>,  use_coefs <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
</code></pre>
</div>
<p><span class="math display">\[
\log ({ \widehat{E( \operatorname{y} )} })  = 1.01 + 1.99(\operatorname{x})
\]</span></p>
</div>
<p>We can put this on the data scale</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>p_pois1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='fu'>ggeffects</span><span class='fu'>::</span><span class='fu'><a href='https://strengejacke.github.io/ggeffects/reference/ggpredict.html'>ggpredict</a></span><span class='op'>(</span><span class='va'>pois1</span>, terms <span class='op'>=</span> <span class='st'>"x"</span><span class='op'>)</span>, add.data <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='va'>p_pois1</span>
</code></pre>
</div>
<p><img src="lecture_8_files/figure-html5/unnamed-chunk-45-1.png" width="1152" /></p>
</div>
<p>Let’s compare this to a model in which we assume a normal distribution</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>pois2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/glm.html'>glm</a></span><span class='op'>(</span><span class='va'>y</span> <span class='op'>~</span> <span class='va'>x</span>, data <span class='op'>=</span> <span class='va'>fake</span><span class='op'>)</span> <span class='co'># remove "family = `poisson`)</span>
<span class='fu'>model_parameters</span><span class='op'>(</span><span class='va'>pois2</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>Parameter   | Coefficient |   SE |         95% CI | t(48) |      p
------------------------------------------------------------------
(Intercept) |       15.19 | 2.35 | [10.58, 19.81] |  6.45 | &lt; .001
x           |       14.73 | 2.04 | [10.73, 18.73] |  7.22 | &lt; .001</code></pre>
</div>
<p>Quick plot:</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>p_pois2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='fu'>ggeffects</span><span class='fu'>::</span><span class='fu'><a href='https://strengejacke.github.io/ggeffects/reference/ggpredict.html'>ggpredict</a></span><span class='op'>(</span><span class='va'>pois2</span>, terms <span class='op'>=</span> <span class='st'>"x"</span><span class='op'>)</span>, add.data <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='va'>p_pois2</span>
</code></pre>
</div>
<p><img src="lecture_8_files/figure-html5/unnamed-chunk-47-1.png" width="1152" /></p>
</div>
<h3 id="model-checks">Model checks</h3>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>performance</span><span class='fu'>::</span><span class='fu'><a href='https://easystats.github.io/performance/reference/check_model.html'>check_model</a></span><span class='op'>(</span><span class='va'>pois1</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="lecture_8_files/figure-html5/unnamed-chunk-48-1.png" width="1152" /></p>
</div>
<p>We can see the linearity assumption is violated:</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>performance</span><span class='fu'>::</span><span class='fu'><a href='https://easystats.github.io/performance/reference/check_model.html'>check_model</a></span><span class='op'>(</span><span class='va'>pois2</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="lecture_8_files/figure-html5/unnamed-chunk-49-1.png" width="1152" /></p>
</div>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>splines</span><span class='op'>)</span>

<span class='va'>pois3</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/glm.html'>glm</a></span><span class='op'>(</span><span class='va'>y</span> <span class='op'>~</span> <span class='fu'><a href='https://rdrr.io/r/splines/bs.html'>bs</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>, data <span class='op'>=</span> <span class='va'>fake</span><span class='op'>)</span> <span class='co'># remove "family = `poisson`)</span>
<span class='fu'>model_parameters</span><span class='op'>(</span><span class='va'>pois3</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>Parameter      | Coefficient |   SE |           95% CI |  t(46) |      p
------------------------------------------------------------------------
(Intercept)    |       -6.57 | 2.13 | [-10.74,  -2.39] |  -3.08 | 0.003 
x [1st degree] |       43.71 | 7.41 | [ 29.19,  58.23] |   5.90 | &lt; .001
x [2nd degree] |      -67.11 | 5.30 | [-77.50, -56.72] | -12.66 | &lt; .001
x [3rd degree] |      118.01 | 4.46 | [109.26, 126.76] |  26.44 | &lt; .001</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>p_pois3</span><span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='fu'>ggeffects</span><span class='fu'>::</span><span class='fu'><a href='https://strengejacke.github.io/ggeffects/reference/ggpredict.html'>ggpredict</a></span><span class='op'>(</span><span class='va'>pois3</span>, terms <span class='op'>=</span> <span class='st'>"x"</span><span class='op'>)</span>, add.data <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='va'>p_pois3</span>
</code></pre>
</div>
<p><img src="lecture_8_files/figure-html5/unnamed-chunk-51-1.png" width="1152" /></p>
</div>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://patchwork.data-imaginist.com'>patchwork</a></span><span class='op'>)</span>
<span class='va'>p_pois1</span> <span class='op'>+</span> <span class='va'>p_pois2</span> <span class='op'>+</span> <span class='va'>p_pois3</span> <span class='op'>+</span> <span class='fu'><a href='https://patchwork.data-imaginist.com/reference/plot_annotation.html'>plot_annotation</a></span><span class='op'>(</span>title <span class='op'>=</span> <span class='st'>"comparison of three assumed distributions"</span>, tag_levels <span class='op'>=</span> <span class='st'>'a'</span>,
                                              subtitle <span class='op'>=</span> <span class='st'>"The Poisson model (a) fits \nThe gaussian model (b) underfitsthe \nThe spline model (c) overfits"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://patchwork.data-imaginist.com/reference/plot_layout.html'>plot_layout</a></span><span class='op'>(</span>guides <span class='op'>=</span> <span class='st'>"collect"</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="lecture_8_files/figure-html5/unnamed-chunk-52-1.png" width="1152" /></p>
</div>
<p>The poisson fits best: this is no surprise: we simulated poisson outcomes.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>per_pois</span> <span class='op'>&lt;-</span><span class='fu'>performance</span><span class='fu'>::</span><span class='fu'><a href='https://easystats.github.io/performance/reference/compare_performance.html'>compare_performance</a></span><span class='op'>(</span><span class='va'>pois1</span>,<span class='va'>pois2</span>,<span class='va'>pois3</span><span class='op'>)</span>
<span class='va'>per_pois</span>
</code></pre>
</div>
<pre><code># Comparison of Model Performance Indices

Name  | Model |     AIC |     BIC |   RMSE |  Sigma |    R2 | Nagelkerke&#39;s R2 | Score_log | Score_spherical
-----------------------------------------------------------------------------------------------------------
pois1 |   glm | 188.481 | 192.305 |  3.361 |  0.985 |       |           1.000 |    -1.845 |           0.097
pois2 |   glm | 426.698 | 432.434 | 16.249 | 16.584 | 0.521 |                 |           |                
pois3 |   glm | 300.273 | 309.833 |  4.410 |  4.597 | 0.965 |                 |           |                </code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>per_pois</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="lecture_8_files/figure-html5/unnamed-chunk-53-1.png" width="1152" /></p>
</div>
<h2 id="negative-binomial-models-over-dispersed-poissons">Negative binomial models (over-dispersed Poissons)</h2>
<h3 id="link-function-for-a-negative-binomial-model">Link function for a negative binomial model</h3>
<p><span class="math display">\[
y_i \sim NegBinomial(\lambda_i,\phi)\\
log(\lambda_i) = \alpha +\beta x_i\\
\phi \sim gamma(.01,.01)
\]</span></p>
<p>Over dispersion in the rate parameter.</p>
<aside>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>gamma_distribution</span><span class='op'>&lt;-</span><span class='fu'><a href='https://rdrr.io/r/stats/GammaDist.html'>rgamma</a></span><span class='op'>(</span><span class='fl'>1000</span>,<span class='fl'>.01</span>,<span class='fl'>.01</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/hist.html'>hist</a></span><span class='op'>(</span><span class='va'>gamma_distribution</span>, breaks <span class='op'>=</span> <span class='fl'>100</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="lecture_8_files/figure-html5/unnamed-chunk-54-1.png" width="1152" /></p>
</div>
</aside>
<p>The expected value of a poisson and the variance of poisson variable are the same: lamda. However often (typically) this assumption is violated, and the random variables in one’s data set are over-dispersed.</p>
<p>To see this, lets simulate data with overdispersion</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://www.stats.ox.ac.uk/pub/MASS4/'>MASS</a></span><span class='op'>)</span>
<span class='va'>n</span> <span class='op'>&lt;-</span> <span class='fl'>100</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Uniform.html'>runif</a></span><span class='op'>(</span><span class='va'>n</span>, <span class='op'>-</span><span class='fl'>2</span>, <span class='fl'>2</span><span class='op'>)</span>
<span class='va'>a</span> <span class='op'>&lt;-</span> <span class='fl'>1</span>
<span class='va'>b</span> <span class='op'>&lt;-</span> <span class='fl'>2</span>
<span class='va'>out</span> <span class='op'>&lt;-</span> <span class='va'>a</span> <span class='op'>+</span> <span class='va'>b</span>  <span class='op'>*</span> <span class='va'>x</span>

<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>999</span><span class='op'>)</span>

<span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/MASS/man/rnegbin.html'>rnegbin</a></span><span class='op'>(</span><span class='va'>n</span>,  mu <span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='va'>out</span><span class='op'>)</span>, theta <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span> <span class='co'># mean overdistribution parameter</span>
<span class='va'>fake2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>x<span class='op'>=</span><span class='va'>x</span>, y<span class='op'>=</span><span class='va'>y</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/hist.html'>hist</a></span><span class='op'>(</span><span class='va'>fake2</span><span class='op'>$</span><span class='va'>y</span>, breaks <span class='op'>=</span> <span class='fl'>50</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="lecture_8_files/figure-html5/unnamed-chunk-55-1.png" width="1152" /></p>
</div>
<p>We fit a poisson model:</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r">
<span class='va'>nb1</span><span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/glm.html'>glm</a></span><span class='op'>(</span><span class='va'>y</span> <span class='op'>~</span> <span class='va'>x</span>, family <span class='op'>=</span> <span class='va'>poisson</span>, <span class='va'>fake2</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>nb1</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>
Call:
glm(formula = y ~ x, family = poisson, data = fake2)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-9.7583  -1.3352  -0.4345   0.8231  11.6413  

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  0.91028    0.07736   11.77   &lt;2e-16 ***
x            2.07293    0.04596   45.10   &lt;2e-16 ***
---
Signif. codes:  
0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 6242.37  on 99  degrees of freedom
Residual deviance:  961.42  on 98  degrees of freedom
AIC: 1249.2

Number of Fisher Scoring iterations: 5</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>performance</span><span class='fu'>::</span><span class='fu'><a href='https://easystats.github.io/performance/reference/check_overdispersion.html'>check_overdispersion</a></span><span class='op'>(</span><span class='va'>nb1</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># Overdispersion test

       dispersion ratio =   9.769
  Pearson&#39;s Chi-Squared = 957.369
                p-value = &lt; 0.001</code></pre>
</div>
<p>Try a negative binomial model</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>nb2</span><span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/MASS/man/glm.nb.html'>glm.nb</a></span><span class='op'>(</span><span class='va'>y</span> <span class='op'>~</span> <span class='va'>x</span>,  data <span class='op'>=</span> <span class='va'>fake2</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>compare_models</span><span class='op'>(</span><span class='va'>nb1</span>,<span class='va'>nb2</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>Parameter    |               nb1 |               nb2
----------------------------------------------------
(Intercept)  | 0.91 (0.76, 1.06) | 1.00 (0.76, 1.25)
x            | 2.07 (1.98, 2.16) | 2.00 (1.80, 2.20)
----------------------------------------------------
Observations |               100 |               100</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='fu'>ggeffects</span><span class='fu'>::</span><span class='fu'><a href='https://strengejacke.github.io/ggeffects/reference/ggpredict.html'>ggpredict</a></span><span class='op'>(</span><span class='va'>nb1</span>,terms<span class='op'>=</span><span class='st'>"x"</span><span class='op'>)</span>, add.data <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="lecture_8_files/figure-html5/unnamed-chunk-59-1.png" width="1152" /></p>
</div>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='fu'>ggeffects</span><span class='fu'>::</span><span class='fu'><a href='https://strengejacke.github.io/ggeffects/reference/ggpredict.html'>ggpredict</a></span><span class='op'>(</span><span class='va'>nb2</span>,terms<span class='op'>=</span><span class='st'>"x"</span><span class='op'>)</span>, add.data <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="lecture_8_files/figure-html5/unnamed-chunk-60-1.png" width="1152" /></p>
</div>
<p>It is clear both from the test statistics and the graphs, that the negative binomial model provides a better fit.</p>
<p>How would a normal linear model do here?</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>lmnb</span><span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/lm.html'>lm</a></span><span class='op'>(</span><span class='va'>y</span> <span class='op'>~</span> <span class='va'>x</span>,  <span class='va'>fake2</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='fu'>ggeffects</span><span class='fu'>::</span><span class='fu'><a href='https://strengejacke.github.io/ggeffects/reference/ggpredict.html'>ggpredict</a></span><span class='op'>(</span><span class='va'>lmnb</span>,terms<span class='op'>=</span><span class='st'>"x"</span><span class='op'>)</span>, add.data <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="lecture_8_files/figure-html5/unnamed-chunk-61-1.png" width="1152" /></p>
</div>
<p>The answer is: not very well.</p>
<h2 id="zero-inflated-poisson-neg-binomial-regression">Zero-inflated poisson/ neg binomial regression</h2>
<h3 id="link-function-for-zero-inflated-poisson">Link function for zero-inflated poisson</h3>
<p><span class="math display">\[
y_i \sim ZIPoisson(p_i, \lambda_i)\\
logit(p_i) = \alpha_p + \beta_p x_i \\
log(\lambda) = \alpha_\lambda + \beta\lambda x_i
\]</span></p>
<p>In the nz dataset, volunteering (hours of charity) look to be zero-inflated, and also over-dispersed.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/hist.html'>hist</a></span><span class='op'>(</span><span class='va'>nz</span><span class='op'>$</span><span class='va'>HoursCharity</span>, breaks <span class='op'>=</span> <span class='fl'>100</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="lecture_8_files/figure-html5/unnamed-chunk-62-1.png" width="1152" /></p>
</div>
<p>We can quickly check the proportion of people who report zero volunteering:</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>nz</span><span class='op'>$</span><span class='va'>HoursCharity</span> <span class='op'>==</span><span class='fl'>0</span>, na.rm<span class='op'>=</span><span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>/</span><span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>nz</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 0.6826594</code></pre>
</div>
<p>We can get a sense of over-dispersion by looking at the ration of the sample variation to the sample mean?</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/stats/sd.html'>sd</a></span><span class='op'>(</span><span class='va'>nz</span><span class='op'>$</span><span class='va'>HoursCharity</span>, na.rm<span class='op'>=</span><span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>/</span><span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>nz</span><span class='op'>$</span><span class='va'>HoursCharity</span>, na.rm<span class='op'>=</span><span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>^</span><span class='fl'>2</span>
</code></pre>
</div>
<pre><code>[1] 1.680429</code></pre>
</div>
<p>There’s about 1.68 more dispersion that a poisson model would expect</p>
<p>Let’s use the performance package to formally check both zero-inflation and overdispersed</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>z1</span> <span class='op'>&lt;-</span><span class='fu'><a href='https://rdrr.io/r/stats/glm.html'>glm</a></span><span class='op'>(</span><span class='va'>HoursCharity</span> <span class='op'>~</span> <span class='fl'>1</span>, family <span class='op'>=</span> <span class='st'>"poisson"</span>, data <span class='op'>=</span> <span class='va'>nz</span><span class='op'>)</span>

<span class='fu'>check_zeroinflation</span><span class='op'>(</span><span class='va'>z1</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># Check for zero-inflation

   Observed zeros: 1992
  Predicted zeros: 536
            Ratio: 0.27</code></pre>
</div>
<p>Next check for over-dispersion:</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>check_overdispersion</span><span class='op'>(</span><span class='va'>z1</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># Overdispersion test

       dispersion ratio =    13.196
  Pearson&#39;s Chi-Squared = 37595.179
                p-value =   &lt; 0.001</code></pre>
</div>
<p>And indeed, we find both.</p>
<p>I use the <code>brms</code> package to estimate zero-inflated and/or negative binomial models</p>
<h3 id="model-syntax-1">Model syntax</h3>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/paul-buerkner/brms'>brms</a></span><span class='op'>)</span>

<span class='co'># Requires integer output </span>
<span class='va'>nz</span><span class='op'>$</span><span class='va'>HoursCharity</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/integer.html'>as.integer</a></span><span class='op'>(</span><span class='va'>nz</span><span class='op'>$</span><span class='va'>HoursCharity</span><span class='op'>)</span>

<span class='co'># </span>
<span class='va'>nz</span><span class='op'>[</span><span class='st'>'Household.INC_s'</span><span class='op'>]</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/as.data.frame.html'>as.data.frame</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/scale.html'>scale</a></span><span class='op'>(</span><span class='va'>nz</span><span class='op'>$</span><span class='va'>Household.INC</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># Scale religion variabile</span>
<span class='va'>nz</span><span class='op'>[</span><span class='st'>'Relid_s'</span><span class='op'>]</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/as.data.frame.html'>as.data.frame</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/scale.html'>scale</a></span><span class='op'>(</span><span class='va'>nz</span><span class='op'>$</span><span class='va'>Relid</span><span class='op'>)</span><span class='op'>)</span>

<span class='va'>b0</span><span class='op'>&lt;-</span> <span class='fu'>brms</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/brms/man/brm.html'>brm</a></span><span class='op'>(</span><span class='va'>HoursCharity</span> <span class='op'>~</span> <span class='va'>Relid_s</span> <span class='op'>+</span> <span class='va'>Household.INC_s</span>, 
                family <span class='op'>=</span> <span class='st'>"zero_inflated_poisson"</span>,
                file <span class='op'>=</span> <span class='fu'>here</span><span class='fu'>::</span><span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"models"</span>, <span class='st'>"zeroinflated_poisson_volunteer"</span><span class='op'>)</span>, 
               data <span class='op'>=</span> <span class='va'>nz</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>b0</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code> Family: zero_inflated_poisson 
  Links: mu = log; zi = identity 
Formula: HoursCharity ~ Relid_s + Household.INC_s 
   Data: nz (Number of observations: 2796) 
Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup samples = 4000

Population-Level Effects: 
                Estimate Est.Error l-95% CI u-95% CI Rhat
Intercept           1.70      0.02     1.67     1.73 1.00
Relid_s             0.00      0.01    -0.02     0.03 1.00
Household.INC_s    -0.09      0.02    -0.12    -0.05 1.00
                Bulk_ESS Tail_ESS
Intercept           4130     2975
Relid_s             4403     3605
Household.INC_s     4163     3213

Family Specific Parameters: 
   Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS
zi     0.70      0.01     0.68     0.72 1.00     3971
   Tail_ESS
zi     2865

Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
<p>My preferred way of graphing the predicted effects of religious identification on volunteering is to generate prediction lines from the posterior samples. This captures uncertainty in an intuitive way. I’ll explain the mechanics when we get to Bayesian estimation, which, by the way, we are already doing here.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span>
  <span class='fu'><a href='https://rdrr.io/pkg/brms/man/conditional_effects.brmsfit.html'>conditional_effects</a></span><span class='op'>(</span>
    <span class='va'>b0</span>,
    spaghetti <span class='op'>=</span> <span class='cn'>TRUE</span>,
    nsamples <span class='op'>=</span> <span class='fl'>100</span>,
    select_points <span class='op'>=</span> <span class='fl'>0.1</span>
  <span class='op'>)</span>,
  points <span class='op'>=</span> <span class='cn'>TRUE</span>,
  point_args <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>alpha <span class='op'>=</span> <span class='fl'>0.1</span>,
                    width <span class='op'>=</span> <span class='fl'>.02</span><span class='op'>)</span>
<span class='op'>)</span> <span class='co'>#  note this command controls which facet </span>
</code></pre>
</div>
<p><img src="lecture_8_files/figure-html5/unnamed-chunk-69-1.png" width="1152" /><img src="lecture_8_files/figure-html5/unnamed-chunk-69-2.png" width="1152" /></p>
</div>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>b1</span> <span class='op'>&lt;-</span> <span class='fu'>brms</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/brms/man/brm.html'>brm</a></span><span class='op'>(</span><span class='va'>HoursCharity</span> <span class='op'>~</span> <span class='va'>Relid_s</span> <span class='op'>+</span> <span class='va'>Household.INC_s</span>, 
                family <span class='op'>=</span> <span class='st'>"zero_inflated_negbinomial"</span>,
                file <span class='op'>=</span> <span class='fu'>here</span><span class='fu'>::</span><span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"models"</span>, <span class='st'>"zeroinflated_neg_bin_volunteer"</span><span class='op'>)</span>,
                data <span class='op'>=</span> <span class='va'>nz</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>b1</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code> Family: zero_inflated_negbinomial 
  Links: mu = log; shape = identity; zi = identity 
Formula: HoursCharity ~ Relid_s + Household.INC_s 
   Data: nz (Number of observations: 2796) 
Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup samples = 4000

Population-Level Effects: 
                Estimate Est.Error l-95% CI u-95% CI Rhat
Intercept           0.89      0.17     0.55     1.18 1.01
Relid_s             0.21      0.05     0.11     0.32 1.00
Household.INC_s    -0.07      0.05    -0.16     0.04 1.00
                Bulk_ESS Tail_ESS
Intercept            691     1276
Relid_s             1147     1830
Household.INC_s     1913     1914

Family Specific Parameters: 
      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS
shape     0.28      0.07     0.17     0.43 1.01      718
zi        0.35      0.11     0.09     0.51 1.01      690
      Tail_ESS
shape     1309
zi        1231

Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
<p>Compare fits of the two models using leave one out cross-validation.</p>
<p>Note that on this index, negative numbers are worse (sorry to confuse…)</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>b0</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/brms/man/add_criterion.html'>add_criterion</a></span><span class='op'>(</span><span class='va'>b0</span>, <span class='st'>"loo"</span><span class='op'>)</span>
<span class='va'>b1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/brms/man/add_criterion.html'>add_criterion</a></span><span class='op'>(</span><span class='va'>b1</span>, <span class='st'>"loo"</span><span class='op'>)</span>

<span class='va'>w</span> <span class='op'>&lt;-</span><span class='fu'><a href='https://rdrr.io/pkg/brms/man/loo_compare.brmsfit.html'>loo_compare</a></span><span class='op'>(</span><span class='va'>b0</span>, <span class='va'>b1</span>, criterion <span class='op'>=</span> <span class='st'>"loo"</span><span class='op'>)</span>
<span class='va'>w</span>
</code></pre>
</div>
<pre><code>   elpd_diff se_diff
b1     0.0       0.0
b0 -1514.3     207.3</code></pre>
</div>
<p>Recall we hadbeen using and AIC/BIC convention to estimate improvements in goodness of fit. We can generate an analous index as follows:</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span><span class='op'>(</span>waic_diff <span class='op'>=</span> <span class='va'>w</span><span class='op'>[</span>, <span class='fl'>1</span><span class='op'>]</span> <span class='op'>*</span> <span class='op'>-</span><span class='fl'>2</span>,
      se        <span class='op'>=</span> <span class='va'>w</span><span class='op'>[</span>, <span class='fl'>2</span><span class='op'>]</span> <span class='op'>*</span> <span class='fl'>2</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>   waic_diff       se
b1      0.00   0.0000
b0   3028.67 414.6912</code></pre>
</div>
<p>And we can see that the negative binomial model fits much better.</p>
<h3 id="predicting-zeros">Predicting zeros</h3>
<p>The estimates in the graphs above are only for the positive (non-zero components of the model). Let’s look at the results again:</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>b1</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code> Family: zero_inflated_negbinomial 
  Links: mu = log; shape = identity; zi = identity 
Formula: HoursCharity ~ Relid_s + Household.INC_s 
   Data: nz (Number of observations: 2796) 
Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup samples = 4000

Population-Level Effects: 
                Estimate Est.Error l-95% CI u-95% CI Rhat
Intercept           0.89      0.17     0.55     1.18 1.01
Relid_s             0.21      0.05     0.11     0.32 1.00
Household.INC_s    -0.07      0.05    -0.16     0.04 1.00
                Bulk_ESS Tail_ESS
Intercept            691     1276
Relid_s             1147     1830
Household.INC_s     1913     1914

Family Specific Parameters: 
      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS
shape     0.28      0.07     0.17     0.43 1.01      718
zi        0.35      0.11     0.09     0.51 1.01      690
      Tail_ESS
shape     1309
zi        1231

Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
<p>The probability of non-volunteering in the preferred model for people who are at the mean Religious Identification and mean Household income in this population is <code>plogis(.35)</code> or 0.5866176. More often than not, we should predict zeros in this population. What predicts the zero component of the model? We can use this syntax:</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>b2</span> <span class='op'>&lt;-</span> <span class='fu'>brms</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/brms/man/brm.html'>brm</a></span><span class='op'>(</span>
  <span class='fu'><a href='https://rdrr.io/pkg/brms/man/brmsformula.html'>bf</a></span><span class='op'>(</span><span class='va'>HoursCharity</span> <span class='op'>~</span> <span class='va'>Relid_s</span> <span class='op'>+</span> <span class='va'>Household.INC_s</span>, <span class='co'># note: use `bf` when you have more than one model, as we do here</span>
     <span class='va'>zi</span> <span class='op'>~</span> <span class='va'>Relid_s</span> <span class='op'>+</span> <span class='va'>Household.INC_s</span><span class='op'>)</span>,
  family <span class='op'>=</span> <span class='st'>"zero_inflated_negbinomial"</span>,
  file <span class='op'>=</span> <span class='fu'>here</span><span class='fu'>::</span><span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"models"</span>, <span class='st'>"zeroinflated_nb_2_volunteer"</span><span class='op'>)</span>,
  data <span class='op'>=</span> <span class='va'>nz</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Let’s look at the results:</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>sjPlot</span><span class='fu'>::</span><span class='fu'><a href='https://strengejacke.github.io/sjPlot/reference/tab_model.html'>tab_model</a></span><span class='op'>(</span><span class='va'>b2</span><span class='op'>)</span>
</code></pre>
</div>
<table style="border-collapse:collapse; border:none;">
<tr>
<th style="border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm;  text-align:left; ">
 
</th>
<th colspan="2" style="border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm; ">
HoursCharity
</th>
</tr>
<tr>
<td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  text-align:left; ">
Predictors
</td>
<td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  ">
Incidence Rate Ratios
</td>
<td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  ">
CI (95%)
</td>
</tr>
<tr>
<td colspan="4" style="font-weight:bold; text-align:left; padding-top:.8em;">
Count Model
</td>
</tr>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; ">
Intercept
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
3.42
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
2.86 – 3.96
</td>
</tr>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; ">
Relid_s
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
1.02
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
0.94 – 1.11
</td>
</tr>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; ">
Household.INC_s
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
0.93
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
0.84 – 1.03
</td>
</tr>
<tr>
<td colspan="3" style="font-weight:bold; text-align:left; padding-top:.8em;">
Zero-Inflated Model
</td>
</tr>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; ">
Intercept
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
1.07
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
0.74 – 1.38
</td>
</tr>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; ">
Relid_s
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
0.52
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
0.42 – 0.61
</td>
</tr>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; ">
Household.INC_s
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
1.02
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
0.88 – 1.18
</td>
</tr>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm; border-top:1px solid;">
Observations
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left; border-top:1px solid;" colspan="2">
2796
</td>
</tr>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;">
R<sup>2</sup> Bayes
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="2">
0.015
</td>
</tr>
</table>
</div>
<h3 id="interpretation-1">Interpretation</h3>
<p>We can graph the results using ggeffects::</p>
<p>Religious identification:</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='fu'>ggeffects</span><span class='fu'>::</span><span class='fu'><a href='https://strengejacke.github.io/ggeffects/reference/ggpredict.html'>ggpredict</a></span><span class='op'>(</span><span class='va'>b2</span>, terms <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Relid_s"</span><span class='op'>)</span><span class='op'>)</span>, 
    add.data <span class='op'>=</span> <span class='cn'>TRUE</span>,  <span class='co'># doesn't work</span>
     dot.alpha <span class='op'>=</span> <span class='fl'>.2</span>,  
     facet <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>  <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/graphics/plot.window.html'>ylim</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>5</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="lecture_8_files/figure-html5/unnamed-chunk-77-1.png" width="1152" /></p>
</div>
<p>Household income:</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='fu'>ggeffects</span><span class='fu'>::</span><span class='fu'><a href='https://strengejacke.github.io/ggeffects/reference/ggpredict.html'>ggpredict</a></span><span class='op'>(</span><span class='va'>b2</span>, terms <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Household.INC_s"</span><span class='op'>)</span><span class='op'>)</span>, 
    add.data <span class='op'>=</span> <span class='cn'>TRUE</span>,  <span class='co'># doesn't work</span>
     dot.alpha <span class='op'>=</span> <span class='fl'>.2</span>,  
     facet <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>  <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/graphics/plot.window.html'>ylim</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>5</span><span class='op'>)</span> <span class='op'>+</span>  <span class='fu'><a href='https://rdrr.io/r/graphics/plot.window.html'>xlim</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>5</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="lecture_8_files/figure-html5/unnamed-chunk-78-1.png" width="1152" /></p>
</div>
<p>Or using my preferred method</p>
<p>Predicted effects of religious identification:</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span>
  <span class='fu'><a href='https://rdrr.io/pkg/brms/man/conditional_effects.brmsfit.html'>conditional_effects</a></span><span class='op'>(</span>
    <span class='va'>b2</span>,
    spaghetti <span class='op'>=</span> <span class='cn'>TRUE</span>,
    nsamples <span class='op'>=</span> <span class='fl'>100</span>,
    select_points <span class='op'>=</span> <span class='fl'>0.1</span>
  <span class='op'>)</span>,
  points <span class='op'>=</span> <span class='cn'>TRUE</span>,
 point_args <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>alpha <span class='op'>=</span> <span class='fl'>0.05</span>,
                    width <span class='op'>=</span> <span class='fl'>.02</span><span class='op'>)</span>,
 ask <span class='op'>=</span> <span class='cn'>FALSE</span>
<span class='op'>)</span>  <span class='op'>+</span> <span class='co'># note this command controls which facet </span>
  <span class='fu'><a href='https://rdrr.io/r/graphics/plot.window.html'>ylim</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='fl'>5</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="lecture_8_files/figure-html5/unnamed-chunk-79-1.png" width="1152" /><img src="lecture_8_files/figure-html5/unnamed-chunk-79-2.png" width="1152" /></p>
<pre><code>NULL</code></pre>
</div>
<p>Note:</p>
<blockquote>
<p>Models of class brmsfit always condition on the zero-inflation component, if the model has such a component. Hence, there is no type = “zero_inflated” nor type = “zi_random” for brmsfit-models, because predictions are based on draws of the posterior distribution, which already account for the zero-inflation part of the model.</p>
</blockquote>
<p>See <a href="https://strengejacke.github.io/ggeffects/reference/ggpredict.html">package description</a></p>
<p>Comparing models we find that adding the prdictors improves the model</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>b2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/brms/man/add_criterion.html'>add_criterion</a></span><span class='op'>(</span><span class='va'>b2</span>, <span class='st'>"loo"</span><span class='op'>)</span>

<span class='va'>w</span> <span class='op'>&lt;-</span><span class='fu'><a href='https://rdrr.io/pkg/brms/man/loo_compare.brmsfit.html'>loo_compare</a></span><span class='op'>(</span><span class='va'>b0</span>, <span class='va'>b1</span>, <span class='va'>b2</span>,  criterion <span class='op'>=</span> <span class='st'>"loo"</span><span class='op'>)</span>
<span class='va'>w</span>
</code></pre>
</div>
<pre><code>   elpd_diff se_diff
b2     0.0       0.0
b1   -50.0      10.1
b0 -1564.3     205.9</code></pre>
</div>
<p>Again we can use an -2 * loglik analogue</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r">
<span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span><span class='op'>(</span>waic_diff <span class='op'>=</span> <span class='va'>w</span><span class='op'>[</span>, <span class='fl'>1</span><span class='op'>]</span> <span class='op'>*</span> <span class='op'>-</span><span class='fl'>2</span>,
      se        <span class='op'>=</span> <span class='va'>w</span><span class='op'>[</span>, <span class='fl'>2</span><span class='op'>]</span> <span class='op'>*</span> <span class='fl'>2</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>    waic_diff        se
b2    0.00000   0.00000
b1   99.99377  20.20262
b0 3128.66401 411.85928</code></pre>
</div>
<p>Another way to see this is to look at the posterior predictive checks on the models</p>
<p>Zero-inflated poisson</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>brms</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/brms/man/pp_check.brmsfit.html'>pp_check</a></span><span class='op'>(</span><span class='va'>b0</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/graphics/plot.window.html'>xlim</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>5</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="lecture_8_files/figure-html5/unnamed-chunk-82-1.png" width="1152" /></p>
</div>
<p>Zero-inflated negative binomial with no predictors for the zero-inflation part.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>brms</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/brms/man/pp_check.brmsfit.html'>pp_check</a></span><span class='op'>(</span><span class='va'>b1</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/graphics/plot.window.html'>xlim</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>5</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="lecture_8_files/figure-html5/unnamed-chunk-83-1.png" width="1152" /></p>
</div>
<p>Zero-inflated negative binomial + predictors for the zero-inflation part</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>brms</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/brms/man/pp_check.brmsfit.html'>pp_check</a></span><span class='op'>(</span><span class='va'>b2</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/graphics/plot.window.html'>xlim</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>5</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="lecture_8_files/figure-html5/unnamed-chunk-84-1.png" width="1152" /></p>
</div>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>b2</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code> Family: zero_inflated_negbinomial 
  Links: mu = log; shape = identity; zi = logit 
Formula: HoursCharity ~ Relid_s + Household.INC_s 
         zi ~ Relid_s + Household.INC_s
   Data: nz (Number of observations: 2796) 
Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup samples = 4000

Population-Level Effects: 
                   Estimate Est.Error l-95% CI u-95% CI
Intercept              1.23      0.08     1.05     1.38
zi_Intercept           0.05      0.16    -0.30     0.32
Relid_s                0.02      0.04    -0.07     0.10
Household.INC_s       -0.07      0.05    -0.17     0.03
zi_Relid_s            -0.65      0.09    -0.86    -0.50
zi_Household.INC_s     0.02      0.07    -0.13     0.16
                   Rhat Bulk_ESS Tail_ESS
Intercept          1.00     1788     2073
zi_Intercept       1.01     1503     1833
Relid_s            1.00     3050     2507
Household.INC_s    1.00     3128     2903
zi_Relid_s         1.00     2623     2189
zi_Household.INC_s 1.00     3398     2803

Family Specific Parameters: 
      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS
shape     0.45      0.06     0.33     0.58 1.01     1583
      Tail_ESS
shape     2060

Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
<h2 id="reporting">Reporting</h2>
<p>You can start with the <code>report</code> package to generate reports. However, be careful about reporting using boilerplate because it is up to you, as an applied scientist, to interpret your results</p>
<p>For example the <code>report</code> package describes the <span class="math inline">\(R^2\)</span> statistic. For reasons we can discuss in lab, this statistic is problematic, especially for observational studies.</p>
<p>A better option for expressing practical interest of a result is to describe the expected values of out an outcome across a range of predictors. We have been doing this all along with our graphical models. However, you might want to report the numbers for these expected values as well. For this purpose, the ggeffects package can be handy. You merely leave out the <code>plot</code> component of your syntax:</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>ggeffects</span><span class='fu'>::</span><span class='fu'><a href='https://strengejacke.github.io/ggeffects/reference/ggpredict.html'>ggpredict</a></span><span class='op'>(</span><span class='va'>b2</span>, terms <span class='op'>=</span> <span class='st'>"Relid_s"</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># Predicted counts of HoursCharity
# x = Relid_s

    x | Predicted |       95% CI
--------------------------------
-0.64 |      1.29 | [1.14, 1.46]
-0.25 |      1.51 | [1.36, 1.68]
 0.15 |      1.74 | [1.58, 1.92]
 0.54 |      1.97 | [1.78, 2.18]
 0.94 |      2.19 | [1.97, 2.45]
 1.33 |      2.41 | [2.13, 2.72]
 1.73 |      2.61 | [2.26, 3.00]
 2.12 |      2.78 | [2.35, 3.28]

Adjusted for:
* Household.INC_s = 0.01</code></pre>
</div>
<p>Here, we have generated the predicted magnitudes of volunteering across the full range of the response variables (Religious Identification, as measured in standard deviation units). The expected volunteering rate of a secular person when other predictors are set to zero is: 1.23 hours [CI 95% 1.14, 1.46] and for a fully religiously identified person when all other predictors are set to zero it is 2.78 hours (CI 95% [2.35, 3.28])</p>
<p>We might want to focus on different elements of the model. The expected volunteering among the secular population (when other predictors are set to zero) <em>who volunteers</em>is <code>exp(1.23)</code>: 3.421 and for a religious person (when other predictors are set to zero) <em>who volunteers</em> is: <code>exp(1.23 + .02 *  2.12)</code>:3.569. expected zero-rate among the secular population is <code>plogis(0.05)</code> 0.512; for a fully identified religious person it is <code>plogis(0.05 + -0.65 *  2.12)</code>: 0.209. This suggests that religious people are less zero-inflated. However among those who volunteer, religion isn’t predicting much of a difference in the number of hours one volunteers (in the baseline population).</p>
<p>Is this interesting? Rather than averaging across both the zero-inflated and volunteering populations, it might be more informative to separately describe behaviour among each of these distinct populations. Remember, as applied scientists, we are not merely trying to be explicit about our assumptions and decisions. We’re trying to improve our beliefs relating to some concrete question. Our reporting must reflect our scientific interests. It must clarify what we’ve learned about the world, as well as how we remain uncertain.</p>
<h2 id="summary">Summary</h2>
<p>Today:</p>
<ul>
<li><p>We have clarified that all linear regression models are “generalised linear model” because all linear regression models imply a link function. Prior to this week, we’d been working with the gaussian linear model, in which the link function is the identify function. However, the Gaussian linear model is a special case.</p>
<ul>
<li>This has taken us a step further into understanding how confusing the term ‘linear’ can be. We’ve already shown that quadratic predictors and splines enable us to estimate non-linerity in the relationships between predictor and response parameters. However, now we can see that the entire edifice of regresion is built upon the link function. This is a non-linear mapping from expected responses to additive and multiplicative predictors.</li>
</ul></li>
<li><p>We have demonstrated how to write four classes of generalised linear models:</p>
<ul>
<li>Logistic regression models, which apply to <em>binary</em> responses;</li>
<li>Poisson regression models, which apply to <em>rates</em>;</li>
<li>Negative binomial models (over-dispersed poisson regression models)</li>
<li>Zero-inflated poisson/negative binomial models, in which rates contain an over abundance of zeros.</li>
</ul></li>
<li><p>We have clarified how to interpret and report the results of a generalised linear model using graphical strategies.</p></li>
</ul>
<h2 class="appendix1" id="appendix-1">Appendix 1</h2>
<p>If you want to graph each predictor separately emply the <code>[[1]]</code> or <code>[[2]</code> syntax as follows:]</p>
<p>Predicted effects of religious identification</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>b2_p1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span>
  <span class='fu'><a href='https://rdrr.io/pkg/brms/man/conditional_effects.brmsfit.html'>conditional_effects</a></span><span class='op'>(</span>
    <span class='va'>b2</span>,
    spaghetti <span class='op'>=</span> <span class='cn'>TRUE</span>,
    nsamples <span class='op'>=</span> <span class='fl'>100</span>,
    select_points <span class='op'>=</span> <span class='fl'>0.1</span>
  <span class='op'>)</span>,
  points <span class='op'>=</span> <span class='cn'>TRUE</span>,
  ask <span class='op'>=</span> <span class='cn'>TRUE</span>,
  point_args <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>alpha <span class='op'>=</span> <span class='fl'>0.1</span>,
                    width <span class='op'>=</span> <span class='fl'>.02</span><span class='op'>)</span>
<span class='op'>)</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span>  <span class='op'>+</span> <span class='co'># note this command controls which facet</span>
  <span class='fu'><a href='https://rdrr.io/r/graphics/plot.window.html'>ylim</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>5</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'>labs</span><span class='op'>(</span>title <span class='op'>=</span> <span class='st'>"Better title"</span>,
                                 subtitle <span class='op'>=</span> <span class='st'>"better subtitle"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>xlab</span><span class='op'>(</span><span class='st'>"Religious Identification (SD units)"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>ylab</span><span class='op'>(</span><span class='st'>"Hours volunteering in the previous week"</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Predicted effects of income:</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='st'><a href='https://patchwork.data-imaginist.com'>"patchwork"</a></span><span class='op'>)</span>
<span class='va'>b2_p1</span> <span class='op'>+</span> <span class='va'>b2_p2</span>
</code></pre>
</div>
<p><img src="lecture_8_files/figure-html5/unnamed-chunk-89-1.png" width="1152" /></p>
</div>
<h2 class="appendix2" id="appendix-2">Appendix 2</h2>
<p>We have covered lots of ground today. The generalised linear models described here are the most commponplace. However there are many more. For those who are curious on how to estimated zero inflated binary data, I recommend Solomon Kurz’s work <a href="https://bookdown.org/ajkurz/Statistical_Rethinking_recoded/monsters-and-mixtures.html#zero-inflated-outcomes">here</a>.</p>
<h2 class="appendix3" id="appendix-3">Appendix 3</h2>
<p>Aside: In Bayesian estimation we often estimate the standard deviation of the mean <span class="math inline">\(\sigma\)</span> , however outside these circles people we describe the same parameter as the variance of the mean, or <span class="math inline">\(\sigma^2\)</span>.</p>
<p>It doesn’t really matter the parameters don’t care how we express them. We can say, “Johannes is 2 meters tall,” or we can say “Johannes is the square root of 4 meters tall” and his height will remain indifferent to our convention. So too, the world is indifferent to whether we write $\sigma$ o r $\sigma^2$</p>
<h2 id="acknowledgments-and-references">Acknowledgments and References</h2>
<p><span class="citation" data-cites="gelman2020"><a href="#ref-gelman2020" role="doc-biblioref">Gelman, Hill, and Vehtari</a> (<a href="#ref-gelman2020" role="doc-biblioref">2020</a>)</span></p>
<p><span class="citation" data-cites="kurz2020"><a href="#ref-kurz2020" role="doc-biblioref">Kurz</a> (<a href="#ref-kurz2020" role="doc-biblioref">2020</a>)</span></p>
<p><span class="citation" data-cites="bürkner2019"><a href="#ref-bürkner2019" role="doc-biblioref">Bürkner and Vuorre</a> (<a href="#ref-bürkner2019" role="doc-biblioref">2019</a>)</span></p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography">
<div id="ref-bürkner2019" class="csl-entry" role="doc-biblioentry">
Bürkner, Paul-Christian, and Matti Vuorre. 2019. <span>“Ordinal Regression Models in Psychology: A Tutorial.”</span> <em>Advances in Methods and Practices in Psychological Science</em> 2 (1): 77–101.
</div>
<div id="ref-gelman2020" class="csl-entry" role="doc-biblioentry">
Gelman, Andrew, Jennifer Hill, and Aki Vehtari. 2020. <em>Regression and Other Stories</em>. Cambridge University Press.
</div>
<div id="ref-kurz2020" class="csl-entry" role="doc-biblioentry">
Kurz, A. Solomon. 2020. Zenodo. <a href="https://doi.org/10.5281/zenodo.4080013">https://doi.org/10.5281/zenodo.4080013</a>.
</div>
</div>
<section class="footnotes" role="doc-endnotes">
<hr />
<ol>
<li id="fn1" role="doc-endnote"><p>It is worth cultivating this explicit habit because we will need it when clarifying our belielfs about the world prior to modelling the world (as we do in Bayesian modelling).<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom">
<h3 id="references">References</h3>
<div id="references-listing"></div>
</div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<!--/radix_placeholder_navigation_after_body-->

</body>

</html>
