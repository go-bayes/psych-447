---
title: "Week 3 Lab"
description: |
author:
  - name: Joseph Bulbulia
    url: https://josephbulbulia.netlify.app
    affiliation: Victoria University of Wellington
    affiliation_url: https://www.wgtn.ac.nz
    orcid_id: 0000-0002-5861-2056
  - name: Johannes Karl 
    url: https://johannes-karl.com
    affiliation: Victoria University of Wellington
    affiliation_url: https://www.wgtn.ac.nz
    orcid_id: 0000-0001-5166-0728
output:
  distill::distill_article:
    self_contained: false
    toc: true
---

## Setup

### Libraries

```{r}
library(tidyverse)
library(lubridate)
library(pmdplyr)
```


### Import  data
```{r}

# read data
nz <- readr::read_csv2(url("https://raw.githubusercontent.com/go-bayes/psych-447/main/data/nz/nz.csv"))

# make characters into factors, note the "mutate_if" command
nz <-nz %>%
  dplyr::mutate_if(is.character, factor)

# make a date variable
nz <- nz %>%
  dplyr::mutate(date = make_date(year = 2009, month = 6, day = 30) + TSCORE)  
```

## Q.  What is the difference?

What are the maximum number of responses for a day in 2018 and the maximum number of responses for a day in 2019? 

#### Solution

This is how I'd do it:

```{r}
nz %>%
  group_by(date, Wave)%>%
  count() %>%
  group_by(Wave)%>%
  dplyr::filter(n == max(n))
```



Here's a longer approach:

```{r}
# 2018 take the first
nz %>%
  group_by(date, Wave) %>%
  count() %>%
  filter(Wave == 2018) %>%
  arrange(desc(n))

# 2019  take the first
nz %>%
  group_by(date, Wave) %>%
  count() %>%
  filter(Wave == 2019) %>%
  arrange(desc(n))

```


How many days between the first and second highest number of responses? 

### Solution

Here are some approaches:

```{r}  
ts<-nz %>%
  group_by(date)%>%
  count() %>%
  arrange(desc(n)) %>%
  as_tibble() %>%
  slice(c(1:2)) %>%
  mutate(diff_days = date - lag(date),
         diff_n = n - lag(n))
```


```{r}
nz %>%
  select(Wave,Id,KESSLER6sum) %>%
  group_by(Id)%>%
  mutate(diff_k6 = lag(KESSLER6sum, order_by = "Id"))
         
         
  group_by(date)%>%
  count() %>%
  arrange(desc(n)) %>%
  as_tibble() %>%
  slice(c(1:2)) %>%
  mutate(diff_days = date - lag(date),
         diff_n = n - lag(n))
```


## Q. Suppose you were born on Dec 25, 1995 at 5.02:22 am Calucalate your age in months on March 20,2021, at 1:22:04pm


### Solution

```{r}
library(lubridate)
alive <-lubridate::interval(ymd_hms("1995-12-25 05:02:22"), ymd_hms("2021-03-21 13:22:04"))

time_length(alive, "months")
```

## Summarise the mean, median, quantile


## Q1. Create an ordered factor from numeric data

The `Religion.Church` variable contains responses to the question: "how many times each month do you attend church or religious service? 

Create factor for people who attend church 0 x per month, 1-3 x per month, or over 4 times per month. Re-level the factor for an ordinal ranking lowest to highest.


## Solution
```{r}
nz %>%
  dplyr::mutate(church_attendance_cats = cut(
    Religion.Church,
    breaks = c(-Inf, 0, 3.99, Inf),
    labels = c("zero", "less_4", "gr_4"),
    right = TRUE,
  )) %>% 
  group_by(church_attendance_cats) %>%
  count()
```

## Another solution

```{r}
nz %>%
  dplyr::select(Religion.Church) %>%
  dplyr::mutate(church_attendance_cats = as.factor(ifelse(
    Religion.Church == 0,
    "zero",
    ifelse(Religion.Church < 4, "less_4", "gr_4")
  ))) %>%
  group_by(church_attendance_cats) %>%
  count()
```

## Q Using methods described in lecture, create a table and graph for average hours of sleep by month in the `nz` dataset

Do the table first, then the graph. What the the table clarify about the graph? 

#### Solutions

Table

```{r}
library(kableExtra)
nz %>%
  select(Id, date, HLTH.SleepHours) %>%
  mutate(month = month(date, label = TRUE))%>%
  group_by(month) %>%
  summarise(
    average_sleep =  mean(HLTH.SleepHours, na.rm = TRUE),
    sd_sleep  =  sd(HLTH.SleepHours, na.rm = TRUE),
    n  = n()  ) %>%
  kbl(caption = "Distress by Year") %>%
   kable_classic_2(c("striped", "hover"), full_width = TRUE)
```


Graph
```{r, eval = FALSE, echo = FALSE}
nz %>%
  select(Id, date, HLTH.SleepHours) %>%
  mutate(month = month(date, label = TRUE))%>%
  group_by(month) %>%
  summarise(
    mn_sh =  mean(HLTH.SleepHours, na.rm = TRUE),
    sd_sh  =  sd(HLTH.SleepHours, na.rm = TRUE),
    n_sh  = n()  ) %>%
  mutate(
    se_sh  = sd_sh  / sqrt(n_sh ),
    lw_ci = mn_sh  - qt(1 - (0.05 / 2), n_sh  - 1) * se_sh ,
    up_ci = mn_sh  + qt(1 - (0.05 / 2), n_sh  - 1) * se_sh 
  ) %>%
  ggplot(., aes(x = month, y = mn_sh , colour = mn_sh )) +
  geom_errorbar(aes(ymin = lw_ci, ymax = up_ci), width = .1) +
  geom_point(size = 3)  +
  scale_y_continuous(limits = c(0,8)) + 
  theme_classic() + scale_fill_viridis_d()
```


The table reveals that the two months in which 





<!-- ## Q1. Find people who were over 13 in Kessler 6 distress in 2019 but not 2018, arrange by biggest difference in distress change among this group. Hint, use the `KESSLER6sum` variable -->

<!-- ```{r} -->

<!-- ``` -->


